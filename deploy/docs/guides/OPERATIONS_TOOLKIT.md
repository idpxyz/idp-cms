# ğŸ› ï¸ è¿ç»´å·¥å…·ç®±

å®Œæ•´çš„ç”Ÿäº§ç¯å¢ƒè¿ç»´å·¥å…·é›†ï¼Œç”¨äºéƒ¨ç½²ã€ç›‘æ§ã€å¤‡ä»½å’Œç»´æŠ¤ã€‚

---

## ğŸ“¦ å·¥å…·æ¸…å•

| å·¥å…· | æ–‡ä»¶ | è¯´æ˜ | ç”¨é€” |
|-----|------|------|------|
| **éƒ¨ç½²å·¥å…·** |
| ç«™ç‚¹é…ç½®å™¨ | `configure-site.sh` | è‡ªåŠ¨é…ç½®ç«™ç‚¹ä¿¡æ¯ | å¿«é€Ÿè®¾ç½®æ–°ç«™ç‚¹ |
| Wagtailç«™ç‚¹åˆ›å»º | `create-wagtail-site.sh` | æ•°æ®åº“ç«™ç‚¹åˆ›å»º | åˆå§‹åŒ–ç«™ç‚¹æ•°æ® |
| Nginxç”Ÿæˆå™¨ | `generate-nginx-config.sh` | ç”ŸæˆNginxé…ç½® | è‡ªåŠ¨é…ç½®åå‘ä»£ç† |
| SSLé…ç½® | `setup-ssl.sh` | è‡ªåŠ¨ç”³è¯·SSLè¯ä¹¦ | HTTPSé…ç½® |
| **ç›‘æ§å·¥å…·** |
| æœåŠ¡ç›‘æ§ | `monitor.sh` | å…¨é¢ç›‘æ§ç³»ç»Ÿ | æ£€æŸ¥æœåŠ¡å¥åº·çŠ¶æ€ |
| **å¤‡ä»½å·¥å…·** |
| è‡ªåŠ¨å¤‡ä»½ | `backup.sh` | å®Œæ•´å¤‡ä»½ç³»ç»Ÿ | å®šæœŸæ•°æ®å¤‡ä»½ |
| æ•°æ®æ¢å¤ | `restore.sh` | ä»å¤‡ä»½æ¢å¤ | ç¾éš¾æ¢å¤ |

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¬¬äºŒå°ä¸»æœºéƒ¨ç½²æµç¨‹

```bash
# 1. å…‹éš†é¡¹ç›®
git clone <ä»“åº“> /opt/aivoya-cms
cd /opt/aivoya-cms

# 2. é…ç½®ç«™ç‚¹ï¼ˆ5åˆ†é’Ÿï¼‰
./configure-site.sh
# è¾“å…¥ç«™ç‚¹ä¿¡æ¯ï¼šaivoya, AIæ—…è¡Œé—¨æˆ·, aivoya.travel

# 3. å¯åŠ¨æœåŠ¡ï¼ˆ3åˆ†é’Ÿï¼‰
./start-production.sh

# 4. åˆ›å»ºç«™ç‚¹
./create-wagtail-site.sh aivoya "AIæ—…è¡Œé—¨æˆ·" aivoya.travel

# 5. é…ç½® Nginxï¼ˆ2åˆ†é’Ÿï¼‰
./generate-nginx-config.sh
# è¾“å…¥åŸŸåå’Œç«¯å£ä¿¡æ¯

# 6. å®‰è£… Nginx é…ç½®
./install-nginx-aivoya.travel.sh

# 7. é…ç½® SSLï¼ˆ3åˆ†é’Ÿï¼‰
./setup-ssl.sh aivoya.travel www.aivoya.travel

# âœ… å®Œæˆï¼æ€»è®¡çº¦ 15 åˆ†é’Ÿ
```

---

## ğŸ“ è¯¦ç»†ä½¿ç”¨æŒ‡å—

### 1. ç«™ç‚¹é…ç½®å™¨

**åŠŸèƒ½ï¼š** è‡ªåŠ¨ä¿®æ”¹ç«™ç‚¹é…ç½®æ–‡ä»¶ï¼ˆå“ç‰Œã€åŸŸåã€ä¸»é¢˜ç­‰ï¼‰

**ä½¿ç”¨æ–¹æ³•ï¼š**

```bash
./configure-site.sh
```

**äº¤äº’å¼è¾“å…¥ï¼š**
- ç«™ç‚¹ IDï¼ˆå¦‚ï¼šaivoyaï¼‰
- ç«™ç‚¹åç§°ï¼ˆå¦‚ï¼šAIæ—…è¡Œé—¨æˆ·ï¼‰
- å“ç‰Œåç§°ï¼ˆå¦‚ï¼šAIæ—…è¡Œï¼‰
- ç”Ÿäº§åŸŸåï¼ˆå¦‚ï¼šaivoya.travelï¼‰
- ä¸»é¢˜ä¸»è‰²è°ƒï¼ˆå¦‚ï¼š#06b6d4ï¼‰

**è‡ªåŠ¨ä¿®æ”¹çš„æ–‡ä»¶ï¼š**
- `.env.core` - æ ¸å¿ƒç¯å¢ƒå˜é‡
- `.env.production` - ç”Ÿäº§ç¯å¢ƒé…ç½®
- `sites/lib/config/sites.ts` - å‰ç«¯ç«™ç‚¹é…ç½®
- `sites/app/globals.css` - ä¸»é¢˜é¢œè‰²

**å¤‡ä»½ï¼š** è‡ªåŠ¨å¤‡ä»½åˆ° `backup/site_config_YYYYMMDD_HHMMSS/`

---

### 2. Wagtail ç«™ç‚¹åˆ›å»º

**åŠŸèƒ½ï¼š** åœ¨ Wagtail CMS æ•°æ®åº“ä¸­åˆ›å»ºæ–°ç«™ç‚¹

**ä½¿ç”¨æ–¹æ³•ï¼š**

```bash
./create-wagtail-site.sh <site_id> <site_name> <hostname>
```

**ç¤ºä¾‹ï¼š**

```bash
./create-wagtail-site.sh aivoya "AIæ—…è¡Œé—¨æˆ·" aivoya.travel
```

**å‰ææ¡ä»¶ï¼š**
- å®¹å™¨å¿…é¡»æ­£åœ¨è¿è¡Œ
- æ•°æ®åº“å·²å®Œæˆè¿ç§»

**è¾“å‡ºï¼š**
- åˆ›å»ºç«™ç‚¹è®°å½•
- è®¾ç½®ä¸ºé»˜è®¤ç«™ç‚¹
- å…³è”æ ¹é¡µé¢

---

### 3. Nginx é…ç½®ç”Ÿæˆå™¨

**åŠŸèƒ½ï¼š** è‡ªåŠ¨ç”Ÿæˆ Nginx åå‘ä»£ç†é…ç½®æ–‡ä»¶

**ä½¿ç”¨æ–¹æ³•ï¼š**

```bash
./generate-nginx-config.sh
```

**äº¤äº’å¼è¾“å…¥ï¼š**
- åŸŸåï¼ˆå¦‚ï¼šaivoya.travelï¼‰
- æ˜¯å¦æ·»åŠ  www å­åŸŸå
- å‰ç«¯ç«¯å£ï¼ˆé»˜è®¤ï¼š3001ï¼‰
- åç«¯ç«¯å£ï¼ˆé»˜è®¤ï¼š8000ï¼‰
- æ˜¯å¦å¯ç”¨ SSL

**ç”Ÿæˆæ–‡ä»¶ï¼š**
- `nginx-<domain>.conf` - Nginx é…ç½®æ–‡ä»¶
- `install-nginx-<domain>.sh` - å®‰è£…è„šæœ¬

**é…ç½®ç‰¹æ€§ï¼š**
- âœ… å‰ç«¯åå‘ä»£ç†
- âœ… åç«¯ API ä»£ç†
- âœ… é™æ€æ–‡ä»¶ç¼“å­˜
- âœ… WebSocket æ”¯æŒ
- âœ… å®‰å…¨å¤´é…ç½®
- âœ… Gzip å‹ç¼©
- âœ… SSL é…ç½®ï¼ˆå¯é€‰ï¼‰

**å®‰è£…é…ç½®ï¼š**

```bash
# è‡ªåŠ¨å®‰è£…
./install-nginx-aivoya.travel.sh

# æˆ–æ‰‹åŠ¨å®‰è£…
sudo cp nginx-aivoya.travel.conf /etc/nginx/sites-available/aivoya.travel
sudo ln -s /etc/nginx/sites-available/aivoya.travel /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl reload nginx
```

---

### 4. SSL è‡ªåŠ¨é…ç½®

**åŠŸèƒ½ï¼š** ä½¿ç”¨ Let's Encrypt è‡ªåŠ¨ç”³è¯·å’Œé…ç½® SSL è¯ä¹¦

**ä½¿ç”¨æ–¹æ³•ï¼š**

```bash
./setup-ssl.sh <domain1> [domain2] [domain3] ...
```

**ç¤ºä¾‹ï¼š**

```bash
# å•åŸŸå
./setup-ssl.sh aivoya.travel

# å¤šåŸŸåï¼ˆä¸»åŸŸå + wwwï¼‰
./setup-ssl.sh aivoya.travel www.aivoya.travel
```

**è‡ªåŠ¨å®Œæˆï¼š**
1. âœ… æ£€æŸ¥ Certbot å®‰è£…
2. âœ… æ£€æŸ¥ DNS è§£æ
3. âœ… ç”³è¯· SSL è¯ä¹¦
4. âœ… é…ç½® Nginx SSL
5. âœ… è®¾ç½® HTTP åˆ° HTTPS é‡å®šå‘
6. âœ… é…ç½®è‡ªåŠ¨ç»­æœŸ

**å‰ææ¡ä»¶ï¼š**
- DNS å·²è§£æåˆ°æœåŠ¡å™¨
- 80 å’Œ 443 ç«¯å£å·²å¼€æ”¾
- Nginx å·²è¿è¡Œ

**è¯ä¹¦ç®¡ç†ï¼š**

```bash
# æŸ¥çœ‹è¯ä¹¦
sudo certbot certificates

# ç»­æœŸæµ‹è¯•
sudo certbot renew --dry-run

# æ‰‹åŠ¨ç»­æœŸ
sudo certbot renew

# æ’¤é”€è¯ä¹¦
sudo certbot revoke --cert-path /etc/letsencrypt/live/aivoya.travel/cert.pem
```

---

### 5. æœåŠ¡ç›‘æ§

**åŠŸèƒ½ï¼š** å…¨é¢ç›‘æ§ç³»ç»Ÿå’ŒæœåŠ¡å¥åº·çŠ¶æ€

**ä½¿ç”¨æ–¹æ³•ï¼š**

```bash
# ä½¿ç”¨é»˜è®¤é…ç½®
./monitor.sh

# æŒ‡å®š Docker Compose æ–‡ä»¶
./monitor.sh infra/local/docker-compose.yml

# è®¾ç½®å‘Šè­¦é‚®ç®±
ALERT_EMAIL=admin@example.com ./monitor.sh
```

**ç›‘æ§é¡¹ç›®ï¼š**

1. **å®¹å™¨çŠ¶æ€**
   - è¿è¡ŒçŠ¶æ€
   - å¥åº·æ£€æŸ¥
   - è‡ªåŠ¨å‘Šè­¦

2. **èµ„æºä½¿ç”¨**
   - CPU ä½¿ç”¨ç‡
   - å†…å­˜ä½¿ç”¨ç‡
   - ç£ç›˜ä½¿ç”¨ç‡
   - Docker å®¹å™¨èµ„æº

3. **æœåŠ¡å¯ç”¨æ€§**
   - åç«¯ API
   - å‰ç«¯æœåŠ¡
   - PostgreSQL
   - Redis

4. **æ—¥å¿—æ£€æŸ¥**
   - æœ€è¿‘é”™è¯¯æ—¥å¿—
   - å¼‚å¸¸ç»Ÿè®¡

**è¾“å‡ºç¤ºä¾‹ï¼š**

```
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ³ å®¹å™¨çŠ¶æ€æ£€æŸ¥
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  âœ… production-authoring-1: running
  âœ… production-sites-1: running
  âœ… production-postgres-1: running
  âœ… production-redis-1: running

âœ… æ‰€æœ‰å®¹å™¨è¿è¡Œæ­£å¸¸

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“Š èµ„æºä½¿ç”¨æƒ…å†µ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  ğŸ’» CPU ä½¿ç”¨ç‡: 15.3%
  ğŸ§  å†…å­˜ä½¿ç”¨: 3.2G / 8.0G (40.0%)
  ğŸ’¾ ç£ç›˜ä½¿ç”¨: 15G / 40G (38%)
```

**å®šæ—¶ç›‘æ§ï¼š**

```bash
# æ·»åŠ  cron ä»»åŠ¡ï¼ˆæ¯å°æ—¶æ£€æŸ¥ä¸€æ¬¡ï¼‰
crontab -e

# æ·»åŠ ä»¥ä¸‹è¡Œ
0 * * * * cd /opt/idp-cms && ALERT_EMAIL=admin@example.com ./monitor.sh >> /var/log/cms-monitor.log 2>&1
```

---

### 6. è‡ªåŠ¨å¤‡ä»½

**åŠŸèƒ½ï¼š** å®Œæ•´å¤‡ä»½æ•°æ®åº“ã€åª’ä½“æ–‡ä»¶å’Œé…ç½®

**ä½¿ç”¨æ–¹æ³•ï¼š**

```bash
# é»˜è®¤å¤‡ä»½
./backup.sh

# è‡ªå®šä¹‰å¤‡ä»½ç›®å½•
BACKUP_DIR=/mnt/backups ./backup.sh

# ä¿ç•™ 30 å¤©çš„å¤‡ä»½
RETENTION_DAYS=30 ./backup.sh

# è‡ªå®šä¹‰å¤‡ä»½åç§°
BACKUP_NAME=aivoya ./backup.sh
```

**å¤‡ä»½å†…å®¹ï¼š**

1. **PostgreSQL æ•°æ®åº“**
   - å®Œæ•´ SQL å¯¼å‡º
   - Gzip å‹ç¼©

2. **åª’ä½“æ–‡ä»¶**
   - æ‰€æœ‰ä¸Šä¼ çš„å›¾ç‰‡å’Œæ–‡ä»¶
   - Tar.gz å‹ç¼©

3. **é…ç½®æ–‡ä»¶**
   - ç¯å¢ƒå˜é‡æ–‡ä»¶
   - Docker Compose é…ç½®
   - Nginx é…ç½®ï¼ˆå¦‚æœå­˜åœ¨ï¼‰

4. **å¤‡ä»½æ¸…å•**
   - æ–‡ä»¶åˆ—è¡¨
   - æ¢å¤è¯´æ˜

**å¤‡ä»½ç»“æ„ï¼š**

```
backups/
â””â”€â”€ cms-20251011_143025/
    â”œâ”€â”€ database.sql.gz      # æ•°æ®åº“å¤‡ä»½
    â”œâ”€â”€ media.tar.gz         # åª’ä½“æ–‡ä»¶
    â”œâ”€â”€ configs.tar.gz       # é…ç½®æ–‡ä»¶
    â””â”€â”€ MANIFEST.txt         # å¤‡ä»½æ¸…å•
```

**è‡ªåŠ¨å¤‡ä»½é…ç½®ï¼š**

```bash
# æ¯å¤©å‡Œæ™¨ 2 ç‚¹è‡ªåŠ¨å¤‡ä»½
crontab -e

# æ·»åŠ ä»¥ä¸‹è¡Œ
0 2 * * * cd /opt/idp-cms && ./backup.sh >> /var/log/cms-backup.log 2>&1

# æ¯å‘¨æ—¥å¤‡ä»½åˆ°è¿œç¨‹æœåŠ¡å™¨
0 3 * * 0 cd /opt/idp-cms && ./backup.sh && rsync -av backups/ user@backup-server:/backups/cms/
```

**å¤‡ä»½ç­–ç•¥å»ºè®®ï¼š**

| ç¯å¢ƒ | å¤‡ä»½é¢‘ç‡ | ä¿ç•™æ—¶é—´ | å¤‡ä»½ä½ç½® |
|-----|---------|---------|---------|
| å¼€å‘ç¯å¢ƒ | æ¯å‘¨ | 7 å¤© | æœ¬åœ°ç£ç›˜ |
| æµ‹è¯•ç¯å¢ƒ | æ¯å¤© | 14 å¤© | æœ¬åœ°ç£ç›˜ |
| ç”Ÿäº§ç¯å¢ƒ | æ¯å¤© | 30 å¤© | æœ¬åœ° + è¿œç¨‹ |

---

### 7. æ•°æ®æ¢å¤

**åŠŸèƒ½ï¼š** ä»å¤‡ä»½æ¢å¤æ•°æ®åº“ã€åª’ä½“æ–‡ä»¶å’Œé…ç½®

**ä½¿ç”¨æ–¹æ³•ï¼š**

```bash
# æŸ¥çœ‹å¯ç”¨å¤‡ä»½
ls -l backups/

# æ¢å¤æŒ‡å®šå¤‡ä»½
./restore.sh backups/cms-20251011_143025
```

**æ¢å¤æµç¨‹ï¼š**

1. **æ˜¾ç¤ºå¤‡ä»½ä¿¡æ¯**
   - å¤‡ä»½æ—¶é—´
   - æ–‡ä»¶åˆ—è¡¨
   - å¤§å°ä¿¡æ¯

2. **ç¡®è®¤æ“ä½œ**
   - âš ï¸ è­¦å‘Šï¼šå°†è¦†ç›–å½“å‰æ•°æ®

3. **è‡ªåŠ¨å¤‡ä»½å½“å‰æ•°æ®**
   - ä»¥é˜²æ¢å¤å¤±è´¥
   - ä¿å­˜åˆ°ä¸´æ—¶ç›®å½•

4. **æ¢å¤æ•°æ®**
   - æ¢å¤æ•°æ®åº“
   - æ¢å¤åª’ä½“æ–‡ä»¶
   - æ¢å¤é…ç½®æ–‡ä»¶

5. **é‡å¯æœåŠ¡**
   - è¯¢é—®æ˜¯å¦é‡å¯
   - éªŒè¯æœåŠ¡çŠ¶æ€

**ç¤ºä¾‹ï¼š**

```bash
$ ./restore.sh backups/cms-20251011_143025

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘          ğŸ”„ æ•°æ®æ¢å¤ç³»ç»Ÿ                                              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

å¤‡ä»½ç›®å½•: backups/cms-20251011_143025

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“‹ å¤‡ä»½ä¿¡æ¯
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

å¤‡ä»½æ—¶é—´: 2025-10-11 14:30:25
ä¸»æœºå: aivoya-server
å¤‡ä»½åç§°: cms

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âš ï¸  è­¦å‘Šï¼šæ­¤æ“ä½œå°†è¦†ç›–å½“å‰æ•°æ®ï¼
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

æ¢å¤å†…å®¹:
  â€¢ æ•°æ®åº“
  â€¢ åª’ä½“æ–‡ä»¶
  â€¢ é…ç½®æ–‡ä»¶

ç¡®è®¤ç»§ç»­ï¼Ÿè¾“å…¥ 'yes' ç»§ç»­: yes

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
1ï¸âƒ£  æ¢å¤æ•°æ®åº“
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“¦ è§£å‹æ•°æ®åº“å¤‡ä»½...
ğŸ’¾ å¤‡ä»½å½“å‰æ•°æ®åº“ï¼ˆä»¥é˜²ä¸‡ä¸€ï¼‰...
ğŸ”„ æ¢å¤æ•°æ®åº“...
âœ… æ•°æ®åº“æ¢å¤å®Œæˆ

...

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âœ… æ¢å¤å®Œæˆï¼
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

æ¢å¤æ—¶é—´: 45s

ğŸ“ ä¸‹ä¸€æ­¥:
  1. æ£€æŸ¥æœåŠ¡çŠ¶æ€: docker compose ps
  2. æŸ¥çœ‹æ—¥å¿—: docker compose logs -f
  3. è®¿é—®ç½‘ç«™éªŒè¯åŠŸèƒ½
```

---

## ğŸ”§ ç¯å¢ƒå˜é‡

æ‰€æœ‰è„šæœ¬æ”¯æŒçš„ç¯å¢ƒå˜é‡ï¼š

| å˜é‡ | è¯´æ˜ | é»˜è®¤å€¼ | ç¤ºä¾‹ |
|-----|------|--------|------|
| `BACKUP_DIR` | å¤‡ä»½ç›®å½• | `./backups` | `/mnt/backups` |
| `RETENTION_DAYS` | å¤‡ä»½ä¿ç•™å¤©æ•° | `7` | `30` |
| `BACKUP_NAME` | å¤‡ä»½åç§°å‰ç¼€ | `cms` | `aivoya` |
| `COMPOSE_FILE` | Docker Compose æ–‡ä»¶ | `infra/production/docker-compose.yml` | `infra/local/docker-compose.yml` |
| `ALERT_EMAIL` | å‘Šè­¦é‚®ç®± | æ—  | `admin@example.com` |

**ä½¿ç”¨ç¤ºä¾‹ï¼š**

```bash
# è®¾ç½®å•ä¸ªå˜é‡
BACKUP_DIR=/mnt/backups ./backup.sh

# è®¾ç½®å¤šä¸ªå˜é‡
BACKUP_DIR=/mnt/backups RETENTION_DAYS=30 BACKUP_NAME=aivoya ./backup.sh

# å¯¼å‡ºå˜é‡ï¼ˆå¯¹æ‰€æœ‰å‘½ä»¤ç”Ÿæ•ˆï¼‰
export BACKUP_DIR=/mnt/backups
export ALERT_EMAIL=admin@example.com
./backup.sh
./monitor.sh
```

---

## ğŸ“Š æœ€ä½³å®è·µ

### éƒ¨ç½²æµç¨‹

1. **æœ¬åœ°æµ‹è¯•**
   ```bash
   # å…ˆåœ¨æœ¬åœ°æµ‹è¯•æ‰€æœ‰é…ç½®
   ./start.sh
   ```

2. **ç”Ÿäº§éƒ¨ç½²**
   ```bash
   # é…ç½®ç«™ç‚¹
   ./configure-site.sh
   
   # å¯åŠ¨ç”Ÿäº§ç¯å¢ƒ
   ./start-production.sh
   
   # åˆ›å»ºç«™ç‚¹
   ./create-wagtail-site.sh <id> <name> <domain>
   ```

3. **é…ç½®åŸŸå**
   ```bash
   # ç”Ÿæˆ Nginx é…ç½®
   ./generate-nginx-config.sh
   
   # å®‰è£…é…ç½®
   ./install-nginx-<domain>.sh
   
   # é…ç½® SSL
   ./setup-ssl.sh <domain>
   ```

### ç›‘æ§ç­–ç•¥

```bash
# 1. è®¾ç½®å®æ—¶ç›‘æ§ï¼ˆæ¯å°æ—¶ï¼‰
crontab -e
0 * * * * cd /opt/idp-cms && ALERT_EMAIL=admin@example.com ./monitor.sh >> /var/log/cms-monitor.log 2>&1

# 2. æ‰‹åŠ¨æ£€æŸ¥
./monitor.sh

# 3. ç”Ÿæˆè¯¦ç»†æŠ¥å‘Š
./monitor.sh --report
```

### å¤‡ä»½ç­–ç•¥

```bash
# 1. æ¯æ—¥è‡ªåŠ¨å¤‡ä»½
crontab -e
0 2 * * * cd /opt/idp-cms && ./backup.sh >> /var/log/cms-backup.log 2>&1

# 2. æ¯å‘¨è¿œç¨‹å¤‡ä»½
0 3 * * 0 rsync -av /opt/idp-cms/backups/ user@backup-server:/backups/cms/

# 3. æ¯æœˆå®Œæ•´å¤‡ä»½
0 4 1 * * cd /opt/idp-cms && BACKUP_NAME=monthly ./backup.sh
```

### å®‰å…¨å»ºè®®

1. **é™åˆ¶è„šæœ¬æƒé™**
   ```bash
   chmod 700 *.sh
   ```

2. **ä½¿ç”¨ç¯å¢ƒå˜é‡å­˜å‚¨æ•æ„Ÿä¿¡æ¯**
   ```bash
   export DB_PASSWORD="secret"
   export ALERT_EMAIL="admin@example.com"
   ```

3. **å®šæœŸæ›´æ–°**
   ```bash
   # ç³»ç»Ÿæ›´æ–°
   sudo apt update && sudo apt upgrade
   
   # Docker é•œåƒæ›´æ–°
   docker compose pull
   docker compose up -d
   ```

---

## ğŸ†˜ æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜

**1. å®¹å™¨å¯åŠ¨å¤±è´¥**

```bash
# æŸ¥çœ‹æ—¥å¿—
docker compose logs <service_name>

# æ£€æŸ¥é…ç½®
docker compose config

# é‡å¯æœåŠ¡
docker compose restart <service_name>
```

**2. æ•°æ®åº“è¿æ¥å¤±è´¥**

```bash
# æ£€æŸ¥æ•°æ®åº“
docker compose exec postgres pg_isready

# æŸ¥çœ‹è¿æ¥
docker compose exec postgres psql -U postgres -c "\l"

# é‡å¯æ•°æ®åº“
docker compose restart postgres
```

**3. SSL è¯ä¹¦ç”³è¯·å¤±è´¥**

```bash
# æ£€æŸ¥ DNS
host <domain>

# æ£€æŸ¥ç«¯å£
sudo netstat -tlnp | grep -E ':(80|443)'

# æŸ¥çœ‹æ—¥å¿—
sudo less /var/log/letsencrypt/letsencrypt.log
```

**4. å¤‡ä»½å¤±è´¥**

```bash
# æ£€æŸ¥ç£ç›˜ç©ºé—´
df -h

# æ£€æŸ¥æƒé™
ls -la backups/

# æ‰‹åŠ¨æµ‹è¯•æ•°æ®åº“å¯¼å‡º
docker compose exec postgres pg_dump -U postgres cms > test.sql
```

---

## ğŸ“ è·å–å¸®åŠ©

æ‰€æœ‰è„šæœ¬éƒ½æ”¯æŒ `--help` å‚æ•°ï¼š

```bash
./configure-site.sh --help
./generate-nginx-config.sh --help
./setup-ssl.sh --help
./monitor.sh --help
./backup.sh --help
./restore.sh --help
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- `DEPLOY_SECOND_HOST.md` - ç¬¬äºŒå°ä¸»æœºéƒ¨ç½²æŒ‡å—
- `MULTI_SITE_DEPLOYMENT_GUIDE.md` - å¤šç«™ç‚¹éƒ¨ç½²æ–¹æ¡ˆ
- `PRODUCTION_DEPLOYMENT_GUIDE.md` - ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æŒ‡å—
- `ADAPTIVE_LAYOUT_OPTIMIZATION.md` - å¸ƒå±€ä¼˜åŒ–è¯´æ˜

---

**æœ€åæ›´æ–°ï¼š** 2025-10-11  
**ç‰ˆæœ¬ï¼š** 1.0.0  
**ç»´æŠ¤è€…ï¼š** DevOps Team

