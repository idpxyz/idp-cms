# å¤šç«™ç‚¹é…ç½®ç®¡ç†ç³»ç»ŸæŒ‡å—

## ğŸ“‹ ç›®å½•

1. [ç³»ç»Ÿæ¦‚è¿°](#ç³»ç»Ÿæ¦‚è¿°)
2. [é…ç½®ç»“æ„](#é…ç½®ç»“æ„)
3. [ä½¿ç”¨æ–¹æ³•](#ä½¿ç”¨æ–¹æ³•)
4. [ç®¡ç†å‘½ä»¤](#ç®¡ç†å‘½ä»¤)
5. [APIæ¥å£](#apiæ¥å£)
6. [éªŒè¯å’Œé”™è¯¯å¤„ç†](#éªŒè¯å’Œé”™è¯¯å¤„ç†)
7. [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)
8. [æ•…éšœæ’é™¤](#æ•…éšœæ’é™¤)

## ğŸŒŸ ç³»ç»Ÿæ¦‚è¿°

å¤šç«™ç‚¹é…ç½®ç®¡ç†ç³»ç»Ÿæä¾›äº†ä¸€ä¸ªç»Ÿä¸€ã€çµæ´»ä¸”ç±»å‹å®‰å…¨çš„æ–¹å¼æ¥ç®¡ç†ä¸åŒç«™ç‚¹çš„é…ç½®ã€‚

### æ ¸å¿ƒç‰¹æ€§

- **ğŸ—ï¸ å±‚çº§åŒ–é…ç½®**: æ”¯æŒå…¨å±€ã€ç«™ç‚¹ã€ç”¨æˆ·çº§åˆ«çš„é…ç½®ç»§æ‰¿
- **ğŸ”„ åŠ¨æ€åŠ è½½**: é…ç½®æ–‡ä»¶å˜æ›´æ—¶è‡ªåŠ¨é‡è½½ï¼Œæ”¯æŒçƒ­æ›´æ–°
- **âœ… ç±»å‹å®‰å…¨**: åŸºäºdataclassçš„å¼ºç±»å‹é…ç½®æ¨¡å‹
- **ğŸ” éªŒè¯ç³»ç»Ÿ**: å†…ç½®é…ç½®éªŒè¯å’Œé”™è¯¯æ£€æŸ¥
- **ğŸ’¾ ç¼“å­˜æœºåˆ¶**: æ™ºèƒ½ç¼“å­˜æå‡æ€§èƒ½
- **ğŸŒ ç¯å¢ƒè¦†ç›–**: æ”¯æŒç¯å¢ƒå˜é‡è¦†ç›–é…ç½®é¡¹
- **ğŸ“ å®¡è®¡æ—¥å¿—**: é…ç½®å˜æ›´è®°å½•å’Œç‰ˆæœ¬æ§åˆ¶

### æ¶æ„ç»„ä»¶

```
é…ç½®ç®¡ç†ç³»ç»Ÿ
â”œâ”€â”€ site_config.py          # æ ¸å¿ƒé…ç½®ç±»å’Œç®¡ç†å™¨
â”œâ”€â”€ site_utils.py           # ç«™ç‚¹è¯†åˆ«å’Œå·¥å…·å‡½æ•°
â”œâ”€â”€ management/commands/    # Djangoç®¡ç†å‘½ä»¤
â”‚   â””â”€â”€ site_config.py     # é…ç½®ç®¡ç†CLIå·¥å…·
â”œâ”€â”€ api/rest/              # REST APIæ¥å£
â”‚   â””â”€â”€ site_info.py       # é…ç½®æŸ¥è¯¢API
â””â”€â”€ config/sites/          # é…ç½®æ–‡ä»¶å­˜å‚¨
    â”œâ”€â”€ localhost.yaml
    â”œâ”€â”€ site-a.local.yaml
    â””â”€â”€ site-b.local.yaml
```

## ğŸ“Š é…ç½®ç»“æ„

### é…ç½®æ¨¡å‹

ç³»ç»Ÿä½¿ç”¨Python dataclasså®šä¹‰é…ç½®ç»“æ„ï¼Œç¡®ä¿ç±»å‹å®‰å…¨ï¼š

```python
@dataclass
class SiteConfig:
    # åŸºæœ¬ä¿¡æ¯
    site_name: str
    site_url: str
    description: str = ""
    
    # åŠŸèƒ½ç‰¹æ€§
    features: SiteFeatures = field(default_factory=SiteFeatures)
    
    # æ€§èƒ½è®¾ç½®
    performance: SitePerformance = field(default_factory=SitePerformance)
    
    # UIé…ç½®
    ui: SiteUI = field(default_factory=SiteUI)
    
    # å†…å®¹è®¾ç½®
    content: SiteContent = field(default_factory=SiteContent)
    
    # SEOé…ç½®
    seo: SiteSEO = field(default_factory=SiteSEO)
    
    # åˆ†æé…ç½®
    analytics: SiteAnalytics = field(default_factory=SiteAnalytics)
    
    # è‡ªå®šä¹‰å­—æ®µ
    custom: Dict[str, Any] = field(default_factory=dict)
    
    # å…ƒæ•°æ®
    version: str = "1.0"
    created_at: Optional[str] = None
    updated_at: Optional[str] = None
```

### é…ç½®åˆ†ç±»

#### ğŸ›ï¸ åŠŸèƒ½ç‰¹æ€§ (SiteFeatures)
```yaml
features:
  ai_recommendation: true      # AIæ™ºèƒ½æ¨è
  search_enabled: true         # æœç´¢åŠŸèƒ½
  analytics_enabled: true     # åˆ†æç»Ÿè®¡
  comments_enabled: false     # è¯„è®ºç³»ç»Ÿ
  user_registration: true     # ç”¨æˆ·æ³¨å†Œ
  social_login: false         # ç¤¾äº¤ç™»å½•
  api_access: true            # APIè®¿é—®
```

#### âš¡ æ€§èƒ½è®¾ç½® (SitePerformance)
```yaml
performance:
  cache_timeout: 300          # ç¼“å­˜è¶…æ—¶(ç§’)
  max_articles_per_page: 20   # æ¯é¡µæœ€å¤§æ–‡ç« æ•°
```

#### ğŸ¨ UIé…ç½® (SiteUI)
```yaml
ui:
  theme: "default"            # ä¸»é¢˜åç§°
  primary_color: "#3B82F6"    # ä¸»è‰²è°ƒ
  secondary_color: "#6B7280"  # è¾…åŠ©è‰²
  font_family: "Inter, sans-serif"  # å­—ä½“
  logo_url: ""               # Logo URL
  dark_mode_enabled: true    # æš—é»‘æ¨¡å¼
```

#### ğŸ“ å†…å®¹è®¾ç½® (SiteContent)
```yaml
content:
  default_language: "zh"      # é»˜è®¤è¯­è¨€
  supported_languages:        # æ”¯æŒçš„è¯­è¨€
    - "zh"
    - "en"
  timezone: "Asia/Shanghai"   # æ—¶åŒº
```

#### ğŸ” SEOé…ç½® (SiteSEO)
```yaml
seo:
  meta_title: ""             # SEOæ ‡é¢˜
  meta_description: ""       # SEOæè¿°
  meta_keywords: ""          # SEOå…³é”®è¯
```

#### ğŸ“Š åˆ†æé…ç½® (SiteAnalytics)
```yaml
analytics:
  google_analytics_id: ""    # GAè¿½è¸ªID
  track_user_behavior: true  # ç”¨æˆ·è¡Œä¸ºè¿½è¸ª
```

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### åœ¨Pythonä»£ç ä¸­ä½¿ç”¨

#### è·å–ç«™ç‚¹é…ç½®
```python
from apps.core.site_config import get_site_config

# è·å–å®Œæ•´é…ç½®
config = get_site_config('localhost')
print(config.site_name)

# è·å–ç‰¹å®šåŠŸèƒ½è®¾ç½®
if config.features.ai_recommendation:
    # å¯ç”¨AIæ¨èé€»è¾‘
    pass
```

#### è·å–ç‰¹å®šé…ç½®é¡¹
```python
from apps.core.site_config import get_site_setting

# è·å–UIè®¾ç½®
primary_color = get_site_setting('localhost', 'ui', 'primary_color')

# è·å–æ€§èƒ½è®¾ç½®
cache_timeout = get_site_setting('localhost', 'performance', 'cache_timeout', 300)
```

#### æ›´æ–°é…ç½®
```python
from apps.core.site_config import update_site_config

# æ›´æ–°å•ä¸ªé…ç½®é¡¹
updates = {
    'ui': {
        'primary_color': '#FF6B6B'
    }
}
success = update_site_config('localhost', updates)
```

### åœ¨Djangoæ¨¡æ¿ä¸­ä½¿ç”¨

```django
{% load site_config %}

<!-- è·å–ç«™ç‚¹åç§° -->
<title>{{ site_config.site_name }}</title>

<!-- æ£€æŸ¥åŠŸèƒ½æ˜¯å¦å¯ç”¨ -->
{% if site_config.features.comments_enabled %}
    <!-- æ˜¾ç¤ºè¯„è®ºç»„ä»¶ -->
{% endif %}

<!-- ä½¿ç”¨UIé…ç½® -->
<style>
    :root {
        --primary-color: {{ site_config.ui.primary_color }};
    }
</style>
```

### ç¯å¢ƒå˜é‡è¦†ç›–

å¯ä»¥é€šè¿‡ç¯å¢ƒå˜é‡è¦†ç›–ä»»ä½•é…ç½®é¡¹ï¼š

```bash
# è¦†ç›–UIä¸»è‰²è°ƒ
export SITE_CONFIG_LOCALHOST_UI_PRIMARY_COLOR="#FF6B6B"

# è¦†ç›–åŠŸèƒ½å¼€å…³
export SITE_CONFIG_LOCALHOST_FEATURES_AI_RECOMMENDATION=false

# è¦†ç›–æ€§èƒ½è®¾ç½®
export SITE_CONFIG_LOCALHOST_PERFORMANCE_CACHE_TIMEOUT=600
```

## ğŸ› ï¸ ç®¡ç†å‘½ä»¤

### åˆ—å‡ºæ‰€æœ‰ç«™ç‚¹
```bash
python manage.py site_config list
python manage.py site_config list --format json
```

### æ˜¾ç¤ºç«™ç‚¹é…ç½®
```bash
# æ˜¾ç¤ºå®Œæ•´é…ç½®
python manage.py site_config show localhost

# æ˜¾ç¤ºç‰¹å®šéƒ¨åˆ†
python manage.py site_config show localhost --section features

# ä¸åŒè¾“å‡ºæ ¼å¼
python manage.py site_config show localhost --format json
```

### åˆ›å»ºæ–°ç«™ç‚¹
```bash
# åŸºæœ¬åˆ›å»º
python manage.py site_config create new-site --name "æ–°ç«™ç‚¹" --url "https://new-site.com"

# ä»æ¨¡æ¿åˆ›å»º
python manage.py site_config create new-site --template localhost
```

### æ›´æ–°é…ç½®
```bash
# æ›´æ–°å•ä¸ªé…ç½®é¡¹
python manage.py site_config update localhost site_name="æ–°åç§°"

# æ›´æ–°åµŒå¥—é…ç½®
python manage.py site_config update localhost features.comments_enabled=true

# æ‰¹é‡æ›´æ–°
python manage.py site_config update localhost \
    ui.primary_color="#FF6B6B" \
    features.ai_recommendation=false \
    performance.cache_timeout=600
```

### åˆ é™¤ç«™ç‚¹é…ç½®
```bash
python manage.py site_config delete old-site --force
```

### éªŒè¯é…ç½®
```bash
# éªŒè¯æ‰€æœ‰ç«™ç‚¹
python manage.py site_config validate

# éªŒè¯ç‰¹å®šç«™ç‚¹
python manage.py site_config validate --site localhost

# å°è¯•è‡ªåŠ¨ä¿®å¤
python manage.py site_config validate --fix
```

### è¿ç§»æ—§é…ç½®
```bash
# é¢„è§ˆè¿ç§»
python manage.py site_config migrate --dry-run

# æ‰§è¡Œè¿ç§»
python manage.py site_config migrate
```

## ğŸŒ APIæ¥å£

### è·å–ç«™ç‚¹ä¿¡æ¯
```http
GET /api/site/info?site=localhost
```

å“åº”ï¼š
```json
{
    "site_id": "localhost",
    "site_name": "AIæ—…è¡Œé—¨æˆ·",
    "site_url": "http://localhost:3000",
    "config_system_available": true,
    "features": {
        "ai_recommendation": true,
        "search_enabled": true
    },
    "ui": {
        "theme": "default",
        "primary_color": "#3B82F6"
    }
}
```

### è·å–ç«™ç‚¹åŠŸèƒ½åˆ—è¡¨
```http
GET /api/site/features?site=localhost
```

### æ£€æŸ¥ç‰¹å®šåŠŸèƒ½
```http
GET /api/site/check-feature?site=localhost&feature=ai_recommendation
```

### è·å–ç«™ç‚¹ä¸»é¢˜é…ç½®
```http
GET /api/site/theme?site=localhost
```

## âœ… éªŒè¯å’Œé”™è¯¯å¤„ç†

### é…ç½®éªŒè¯è§„åˆ™

ç³»ç»Ÿå†…ç½®äº†comprehensiveéªŒè¯è§„åˆ™ï¼š

1. **åŸºæœ¬ä¿¡æ¯éªŒè¯**
   - ç«™ç‚¹åç§°ä¸èƒ½ä¸ºç©º
   - ç«™ç‚¹URLæ ¼å¼éªŒè¯
   - ç«™ç‚¹IDæ ¼å¼æ£€æŸ¥

2. **URLæ ¼å¼éªŒè¯**
   - HTTP/HTTPSåè®®æ£€æŸ¥
   - åŸŸåæ ¼å¼éªŒè¯
   - ç«¯å£å·éªŒè¯

3. **åŠŸèƒ½ä¾èµ–éªŒè¯**
   - ç¤¾äº¤ç™»å½•éœ€è¦ç”¨æˆ·æ³¨å†Œ
   - è¯„è®ºç³»ç»Ÿéœ€è¦ç”¨æˆ·ç³»ç»Ÿ

4. **æ€§èƒ½å‚æ•°éªŒè¯**
   - ç¼“å­˜è¶…æ—¶ä¸èƒ½ä¸ºè´Ÿæ•°
   - æ–‡ç« æ•°é‡åˆç†èŒƒå›´

5. **UIé…ç½®éªŒè¯**
   - é¢œè‰²æ ¼å¼æ£€æŸ¥ (#RRGGBB)
   - å­—ä½“åç§°éªŒè¯

6. **å†…å®¹é…ç½®éªŒè¯**
   - æ”¯æŒçš„è¯­è¨€ä»£ç 
   - æ—¶åŒºæ ¼å¼éªŒè¯

7. **SEOä¼˜åŒ–éªŒè¯**
   - æ ‡é¢˜é•¿åº¦é™åˆ¶(60å­—ç¬¦)
   - æè¿°é•¿åº¦é™åˆ¶(160å­—ç¬¦)

8. **åˆ†æé…ç½®éªŒè¯**
   - Google Analytics IDæ ¼å¼

### ä½¿ç”¨éªŒè¯API

```python
from apps.core.site_config import validate_site_config, validate_all_sites

# éªŒè¯å•ä¸ªç«™ç‚¹
result = validate_site_config('localhost')
if not result['is_valid']:
    for error in result['errors']:
        print(f"é”™è¯¯: {error}")

# éªŒè¯æ‰€æœ‰ç«™ç‚¹
results = validate_all_sites()
print(f"æ€»é”™è¯¯æ•°: {results['total_errors']}")
```

### é”™è¯¯ç±»å‹

- **ConfigValidationError**: é…ç½®éªŒè¯é”™è¯¯
- **FileNotFoundError**: é…ç½®æ–‡ä»¶ä¸å­˜åœ¨
- **yaml.YAMLError**: YAMLæ ¼å¼é”™è¯¯
- **ValueError**: é…ç½®å€¼ç±»å‹é”™è¯¯

## ğŸ“ æœ€ä½³å®è·µ

### 1. é…ç½®æ–‡ä»¶ç»„ç»‡
```
config/sites/
â”œâ”€â”€ localhost.yaml          # å¼€å‘ç¯å¢ƒ
â”œâ”€â”€ staging.yaml            # æµ‹è¯•ç¯å¢ƒ
â”œâ”€â”€ production.yaml         # ç”Ÿäº§ç¯å¢ƒ
â”œâ”€â”€ site-a.local.yaml       # ç«™ç‚¹A
â””â”€â”€ site-b.local.yaml       # ç«™ç‚¹B
```

### 2. é…ç½®ç»§æ‰¿ç­–ç•¥
- ä½¿ç”¨ `localhost.yaml` ä½œä¸ºåŸºç¡€æ¨¡æ¿
- ç«™ç‚¹ç‰¹å®šé…ç½®åªè¦†ç›–å·®å¼‚éƒ¨åˆ†
- ç¯å¢ƒé…ç½®åˆ†å±‚ç®¡ç†

### 3. ç‰ˆæœ¬æ§åˆ¶
- é…ç½®æ–‡ä»¶çº³å…¥Gitç‰ˆæœ¬æ§åˆ¶
- æ•æ„Ÿä¿¡æ¯ä½¿ç”¨ç¯å¢ƒå˜é‡
- å˜æ›´é€šè¿‡PRå®¡æŸ¥

### 4. ç¼“å­˜ç­–ç•¥
- ç”Ÿäº§ç¯å¢ƒä½¿ç”¨Redisç¼“å­˜
- å¼€å‘ç¯å¢ƒå¯ä½¿ç”¨æœ¬åœ°ç¼“å­˜
- åˆç†è®¾ç½®ç¼“å­˜è¿‡æœŸæ—¶é—´

### 5. ç›‘æ§å’Œå‘Šè­¦
- å®šæœŸéªŒè¯é…ç½®å®Œæ•´æ€§
- ç›‘æ§é…ç½®åŠ è½½é”™è¯¯
- è®¾ç½®å…³é”®é…ç½®å˜æ›´å‘Šè­¦

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. é…ç½®æ–‡ä»¶ä¸å­˜åœ¨
```
é”™è¯¯: æ‰¾ä¸åˆ°ç«™ç‚¹é…ç½®æ–‡ä»¶
è§£å†³: python manage.py site_config create <site_id>
```

#### 2. YAMLæ ¼å¼é”™è¯¯
```
é”™è¯¯: yaml.scanner.ScannerError
è§£å†³: æ£€æŸ¥YAMLè¯­æ³•ï¼Œç¡®ä¿ç¼©è¿›æ­£ç¡®
```

#### 3. é…ç½®éªŒè¯å¤±è´¥
```
é”™è¯¯: ç«™ç‚¹URLæ ¼å¼æ— æ•ˆ
è§£å†³: ä½¿ç”¨æ­£ç¡®çš„URLæ ¼å¼ (http://æˆ–https://)
```

#### 4. ç¼“å­˜ä¸æ›´æ–°
```
è§£å†³: é‡å¯åº”ç”¨æˆ–æ¸…é™¤ç¼“å­˜
python manage.py shell -c "from django.core.cache import cache; cache.clear()"
```

#### 5. ç¯å¢ƒå˜é‡ä¸ç”Ÿæ•ˆ
```
æ£€æŸ¥: ç¯å¢ƒå˜é‡åç§°æ ¼å¼
æ ¼å¼: SITE_CONFIG_{SITE_ID}_{SECTION}_{KEY}
ä¾‹å¦‚: SITE_CONFIG_LOCALHOST_UI_PRIMARY_COLOR
```

### è°ƒè¯•æ¨¡å¼

åœ¨å¼€å‘ç¯å¢ƒå¯ç”¨è°ƒè¯•ï¼š

```python
# settings.py
SITE_CONFIG_DEBUG = True
SITE_CONFIG_CACHE_ENABLED = False
```

### æ—¥å¿—é…ç½®

```python
LOGGING = {
    'loggers': {
        'apps.core.site_config': {
            'level': 'DEBUG',
            'handlers': ['console'],
        },
    },
}
```

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### 1. ç¼“å­˜ä¼˜åŒ–
- ä½¿ç”¨Redisä½œä¸ºç¼“å­˜åç«¯
- è®¾ç½®åˆç†çš„ç¼“å­˜è¿‡æœŸæ—¶é—´
- å®ç°ç¼“å­˜é¢„çƒ­æœºåˆ¶

### 2. åŠ è½½ä¼˜åŒ–
- å»¶è¿ŸåŠ è½½éå…³é”®é…ç½®
- é…ç½®æ–‡ä»¶å‹ç¼©
- æ‰¹é‡åŠ è½½å¤šç«™ç‚¹é…ç½®

### 3. å†…å­˜ä¼˜åŒ–
- åŠæ—¶æ¸…ç†ä¸ä½¿ç”¨çš„é…ç½®
- ä½¿ç”¨å¼±å¼•ç”¨é¿å…å†…å­˜æ³„æ¼
- ç›‘æ§é…ç½®å¯¹è±¡ç”Ÿå‘½å‘¨æœŸ

## ğŸ”„ å‡çº§å’Œè¿ç§»

### é…ç½®ç‰ˆæœ¬å‡çº§

å½“é…ç½®ç»“æ„å‘ç”Ÿå˜åŒ–æ—¶ï¼š

1. æ›´æ–°é…ç½®æ¨¡å‹
2. ç¼–å†™è¿ç§»è„šæœ¬
3. æ‰§è¡Œè¿ç§»å‘½ä»¤
4. éªŒè¯è¿ç§»ç»“æœ

### è¿ç§»ç¤ºä¾‹

```python
# è¿ç§»è„šæœ¬ç¤ºä¾‹
def migrate_v1_to_v2(config_data):
    # æ·»åŠ æ–°å­—æ®µ
    if 'ui' not in config_data:
        config_data['ui'] = {
            'theme': 'default',
            'primary_color': '#3B82F6'
        }
    
    # é‡å‘½åå­—æ®µ
    if 'old_field' in config_data:
        config_data['new_field'] = config_data.pop('old_field')
    
    return config_data
```

## ğŸ“š æ‰©å±•é˜…è¯»

- [å¤šç«™ç‚¹æ¶æ„æŒ‡å—](./å¤šç«™ç‚¹æ¶æ„æŒ‡å—.md)
- [APIæ–‡æ¡£](./å¤šç«™ç‚¹APIæ–‡æ¡£.md)
- [éƒ¨ç½²è¿ç»´æŒ‡å—](./å¤šç«™ç‚¹éƒ¨ç½²è¿ç»´æŒ‡å—.md)
- [Djangoé…ç½®ç³»ç»Ÿæ–‡æ¡£](https://docs.djangoproject.com/en/stable/topics/settings/)

---

**ç‰ˆæœ¬**: 1.0  
**æœ€åæ›´æ–°**: 2025-08-25  
**ç»´æŠ¤è€…**: AI-Portalå¼€å‘å›¢é˜Ÿ
