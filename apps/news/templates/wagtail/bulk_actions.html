{% load wagtailadmin_tags i18n %}
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‰¹é‡æ“ä½œ - æ–‡ç« ç®¡ç†</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: #f5f7fa;
            color: #2c3e50;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        
        .header h1 {
            font-size: 32px;
            margin-bottom: 10px;
            font-weight: 600;
        }
        
        .header p {
            opacity: 0.95;
            font-size: 15px;
        }
        
        .toolbar {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        
        .toolbar-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .toolbar-row:last-child {
            margin-bottom: 0;
        }
        
        .filter-group {
            display: flex;
            gap: 10px;
            align-items: center;
            flex: 1;
            min-width: 250px;
        }
        
        .filter-group label {
            font-weight: 600;
            color: #555;
            white-space: nowrap;
        }
        
        .filter-group select,
        .filter-group input {
            flex: 1;
            padding: 10px 14px;
            border: 2px solid #e0e6ed;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .filter-group select:focus,
        .filter-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            white-space: nowrap;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }
        
        .btn-success {
            background: #10b981;
            color: white;
        }
        
        .btn-warning {
            background: #f59e0b;
            color: white;
        }
        
        .btn-danger {
            background: #ef4444;
            color: white;
        }
        
        .btn-secondary {
            background: #6b7280;
            color: white;
        }
        
        .btn-info {
            background: #3b82f6;
            color: white;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }
        
        .bulk-actions {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            border: 2px dashed #e0e6ed;
        }
        
        .bulk-actions-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #374151;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .selected-count {
            background: #667eea;
            color: white;
            padding: 2px 12px;
            border-radius: 12px;
            font-size: 14px;
        }
        
        .bulk-actions-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .table-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            overflow: hidden;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        thead {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        thead th {
            padding: 16px;
            text-align: left;
            font-weight: 600;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        tbody tr {
            border-bottom: 1px solid #f1f5f9;
            transition: all 0.3s;
        }
        
        tbody tr:hover {
            background: #f8fafc;
        }
        
        tbody td {
            padding: 16px;
            font-size: 14px;
        }
        
        .checkbox-cell {
            width: 50px;
            text-align: center;
        }
        
        .checkbox-cell input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .status-live {
            background: #d1fae5;
            color: #065f46;
        }
        
        .status-draft {
            background: #fef3c7;
            color: #92400e;
        }
        
        .status-scheduled {
            background: #dbeafe;
            color: #1e40af;
        }
        
        .article-title {
            font-weight: 600;
            color: #1e293b;
            max-width: 400px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .article-meta {
            color: #64748b;
            font-size: 13px;
            margin-top: 4px;
        }
        
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            padding: 20px;
            margin-top: 20px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        
        .pagination a,
        .pagination span {
            padding: 8px 16px;
            border: 2px solid #e0e6ed;
            border-radius: 8px;
            text-decoration: none;
            color: #374151;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .pagination a:hover {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
        
        .pagination .current {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: transparent;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 9999;
            align-items: center;
            justify-content: center;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        .modal-title {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 20px;
            color: #1e293b;
        }
        
        .modal-body {
            margin-bottom: 20px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #374151;
        }
        
        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e6ed;
            border-radius: 8px;
            font-size: 14px;
        }
        
        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .modal-footer {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }
        
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 16px 20px;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            z-index: 10000;
            display: none;
            max-width: 400px;
            border-left: 4px solid #10b981;
        }
        
        .toast.success {
            border-left-color: #10b981;
        }
        
        .toast.error {
            border-left-color: #ef4444;
        }
        
        .toast.active {
            display: block;
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #64748b;
        }
        
        .empty-state svg {
            width: 120px;
            height: 120px;
            margin-bottom: 20px;
            opacity: 0.5;
        }
        
        .empty-state h3 {
            font-size: 20px;
            margin-bottom: 10px;
            color: #374151;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“¦ æ‰¹é‡æ“ä½œ</h1>
            <p>é«˜æ•ˆç®¡ç†æ‚¨çš„æ–‡ç« ï¼Œæ”¯æŒæ‰¹é‡å‘å¸ƒã€ä¿®æ”¹é¢‘é“ã€æ·»åŠ æ ‡ç­¾ç­‰æ“ä½œ</p>
        </div>
        
        <!-- ç­›é€‰å·¥å…·æ  -->
        <div class="toolbar">
            <form method="get" id="filter-form">
                <div class="toolbar-row">
                    <div class="filter-group">
                        <label>ğŸ” æœç´¢ï¼š</label>
                        <input type="text" name="search" value="{{ search }}" placeholder="è¾“å…¥æ–‡ç« æ ‡é¢˜...">
                    </div>
                    
                    <div class="filter-group">
                        <label>ğŸ“‚ é¢‘é“ï¼š</label>
                        <select name="channel">
                            <option value="">å…¨éƒ¨é¢‘é“</option>
                            {% for channel in accessible_channels %}
                            <option value="{{ channel.id }}" {% if channel_filter == channel.id|stringformat:"s" %}selected{% endif %}>
                                {{ channel.name }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label>ğŸ“Š çŠ¶æ€ï¼š</label>
                        <select name="status">
                            <option value="">å…¨éƒ¨</option>
                            <option value="live" {% if status_filter == 'live' %}selected{% endif %}>å·²å‘å¸ƒ</option>
                            <option value="draft" {% if status_filter == 'draft' %}selected{% endif %}>è‰ç¨¿</option>
                        </select>
                    </div>
                    
                    <button type="submit" class="btn btn-primary">
                        ç­›é€‰
                    </button>
                </div>
            </form>
        </div>
        
        <!-- æ‰¹é‡æ“ä½œæŒ‰é’® -->
        <div class="bulk-actions" id="bulk-actions-bar" style="display: none;">
            <div class="bulk-actions-title">
                å·²é€‰æ‹© <span class="selected-count" id="selected-count">0</span> ç¯‡æ–‡ç« 
            </div>
            <div class="bulk-actions-buttons">
                <button class="btn btn-success" onclick="bulkPublish()">
                    âœ… æ‰¹é‡å‘å¸ƒ
                </button>
                <button class="btn btn-warning" onclick="bulkUnpublish()">
                    ğŸ“¥ å–æ¶ˆå‘å¸ƒ
                </button>
                <button class="btn btn-primary" onclick="showChannelModal()">
                    ğŸ“‚ ä¿®æ”¹é¢‘é“
                </button>
                <button class="btn btn-info" onclick="showTagsModal()">
                    ğŸ·ï¸ æ·»åŠ æ ‡ç­¾
                </button>
                <button class="btn btn-secondary" onclick="showPublishTimeModal()">
                    â° è®¾ç½®å‘å¸ƒæ—¶é—´
                </button>
                <button class="btn btn-danger" onclick="bulkDelete()">
                    ğŸ—‘ï¸ åˆ é™¤è‰ç¨¿
                </button>
                <button class="btn btn-info" onclick="bulkExport()">
                    ğŸ“Š å¯¼å‡ºCSV
                </button>
            </div>
        </div>
        
        <!-- æ–‡ç« åˆ—è¡¨ -->
        <div class="table-container">
            {% if articles %}
            <table>
                <thead>
                    <tr>
                        <th class="checkbox-cell">
                            <input type="checkbox" id="select-all" onchange="toggleSelectAll(this)">
                        </th>
                        <th>æ–‡ç« æ ‡é¢˜</th>
                        <th>é¢‘é“</th>
                        <th>ä½œè€…</th>
                        <th>çŠ¶æ€</th>
                        <th>æœ€åä¿®æ”¹</th>
                    </tr>
                </thead>
                <tbody>
                    {% for article in articles %}
                    <tr>
                        <td class="checkbox-cell">
                            <input type="checkbox" class="article-checkbox" value="{{ article.id }}" onchange="updateBulkActions()">
                        </td>
                        <td>
                            <div class="article-title" title="{{ article.title }}">
                                {{ article.title }}
                            </div>
                            <div class="article-meta">
                                ID: {{ article.id }}
                                {% if article.excerpt %}
                                | {{ article.excerpt|slice:":50" }}...
                                {% endif %}
                            </div>
                        </td>
                        <td>
                            {% if article.channel %}
                            {{ article.channel.name }}
                            {% else %}
                            <span style="color: #9ca3af;">æœªåˆ†ç±»</span>
                            {% endif %}
                        </td>
                        <td>{{ article.author_name|default:"æœªçŸ¥" }}</td>
                        <td>
                            {% if article.live %}
                            <span class="status-badge status-live">âœ… å·²å‘å¸ƒ</span>
                            {% elif article.publish_at %}
                            <span class="status-badge status-scheduled">â° å®šæ—¶å‘å¸ƒ</span>
                            {% else %}
                            <span class="status-badge status-draft">ğŸ“ è‰ç¨¿</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if article.latest_revision_created_at %}
                            {{ article.latest_revision_created_at|date:"Y-m-d H:i" }}
                            {% else %}
                            -
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <div class="empty-state">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                </svg>
                <h3>æš‚æ— æ–‡ç« </h3>
                <p>æ²¡æœ‰æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„æ–‡ç« </p>
            </div>
            {% endif %}
        </div>
        
        <!-- åˆ†é¡µ -->
        {% if page_obj.has_other_pages %}
        <div class="pagination">
            {% if page_obj.has_previous %}
            <a href="?page=1{% if search %}&search={{ search }}{% endif %}{% if channel_filter %}&channel={{ channel_filter }}{% endif %}{% if status_filter %}&status={{ status_filter }}{% endif %}">é¦–é¡µ</a>
            <a href="?page={{ page_obj.previous_page_number }}{% if search %}&search={{ search }}{% endif %}{% if channel_filter %}&channel={{ channel_filter }}{% endif %}{% if status_filter %}&status={{ status_filter }}{% endif %}">ä¸Šä¸€é¡µ</a>
            {% endif %}
            
            <span class="current">ç¬¬ {{ page_obj.number }} / {{ page_obj.paginator.num_pages }} é¡µ</span>
            
            {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}{% if search %}&search={{ search }}{% endif %}{% if channel_filter %}&channel={{ channel_filter }}{% endif %}{% if status_filter %}&status={{ status_filter }}{% endif %}">ä¸‹ä¸€é¡µ</a>
            <a href="?page={{ page_obj.paginator.num_pages }}{% if search %}&search={{ search }}{% endif %}{% if channel_filter %}&channel={{ channel_filter }}{% endif %}{% if status_filter %}&status={{ status_filter }}{% endif %}">æœ«é¡µ</a>
            {% endif %}
        </div>
        {% endif %}
    </div>
    
    <!-- ä¿®æ”¹é¢‘é“æ¨¡æ€æ¡† -->
    <div class="modal" id="channel-modal">
        <div class="modal-content">
            <div class="modal-title">ğŸ“‚ æ‰¹é‡ä¿®æ”¹é¢‘é“</div>
            <div class="modal-body">
                <div class="form-group">
                    <label>é€‰æ‹©ç›®æ ‡é¢‘é“ï¼š</label>
                    <select id="target-channel">
                        <option value="">è¯·é€‰æ‹©...</option>
                        {% for channel in accessible_channels %}
                        <option value="{{ channel.id }}">{{ channel.name }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('channel-modal')">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="confirmChangeChannel()">ç¡®è®¤</button>
            </div>
        </div>
    </div>
    
    <!-- æ·»åŠ æ ‡ç­¾æ¨¡æ€æ¡† -->
    <div class="modal" id="tags-modal">
        <div class="modal-content">
            <div class="modal-title">ğŸ·ï¸ æ‰¹é‡æ·»åŠ æ ‡ç­¾</div>
            <div class="modal-body">
                <div class="form-group">
                    <label>è¾“å…¥æ ‡ç­¾ï¼ˆé€—å·åˆ†éš”ï¼‰ï¼š</label>
                    <input type="text" id="tags-input" placeholder="ä¾‹å¦‚ï¼šæ–°é—», çƒ­ç‚¹, æ¨è">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('tags-modal')">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="confirmAddTags()">ç¡®è®¤</button>
            </div>
        </div>
    </div>
    
    <!-- è®¾ç½®å‘å¸ƒæ—¶é—´æ¨¡æ€æ¡† -->
    <div class="modal" id="publish-time-modal">
        <div class="modal-content">
            <div class="modal-title">â° æ‰¹é‡è®¾ç½®å‘å¸ƒæ—¶é—´</div>
            <div class="modal-body">
                <div class="form-group">
                    <label>å‘å¸ƒæ—¶é—´ï¼ˆç•™ç©ºåˆ™æ¸…é™¤ï¼‰ï¼š</label>
                    <input type="datetime-local" id="publish-time-input">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('publish-time-modal')">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="confirmSetPublishTime()">ç¡®è®¤</button>
            </div>
        </div>
    </div>
    
    <!-- Toast é€šçŸ¥ -->
    <div class="toast" id="toast"></div>
    
    <script>
        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
        
        const csrftoken = getCookie('csrftoken');
        
        function getSelectedIds() {
            const checkboxes = document.querySelectorAll('.article-checkbox:checked');
            return Array.from(checkboxes).map(cb => cb.value);
        }
        
        function updateBulkActions() {
            const selected = getSelectedIds();
            const bulkBar = document.getElementById('bulk-actions-bar');
            const countSpan = document.getElementById('selected-count');
            
            if (selected.length > 0) {
                bulkBar.style.display = 'block';
                countSpan.textContent = selected.length;
            } else {
                bulkBar.style.display = 'none';
            }
        }
        
        function toggleSelectAll(checkbox) {
            const checkboxes = document.querySelectorAll('.article-checkbox');
            checkboxes.forEach(cb => cb.checked = checkbox.checked);
            updateBulkActions();
        }
        
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `toast ${type} active`;
            setTimeout(() => {
                toast.classList.remove('active');
            }, 3000);
        }
        
        function showModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }
        
        function bulkPublish() {
            const ids = getSelectedIds();
            if (ids.length === 0) {
                showToast('è¯·å…ˆé€‰æ‹©æ–‡ç« ', 'error');
                return;
            }
            
            if (!confirm(`ç¡®è®¤å‘å¸ƒé€‰ä¸­çš„ ${ids.length} ç¯‡æ–‡ç« ï¼Ÿ`)) {
                return;
            }
            
            fetch('/admin/articles/bulk/publish/', {
                method: 'POST',
                headers: {
                    'X-CSRFToken': csrftoken,
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: new URLSearchParams({ 'article_ids[]': ids })
            })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    showToast(data.message, 'success');
                    setTimeout(() => location.reload(), 1500);
                } else {
                    showToast(data.message || 'æ“ä½œå¤±è´¥', 'error');
                }
            })
            .catch(err => {
                showToast('ç½‘ç»œé”™è¯¯', 'error');
            });
        }
        
        function bulkUnpublish() {
            const ids = getSelectedIds();
            if (ids.length === 0) {
                showToast('è¯·å…ˆé€‰æ‹©æ–‡ç« ', 'error');
                return;
            }
            
            if (!confirm(`ç¡®è®¤å–æ¶ˆå‘å¸ƒé€‰ä¸­çš„ ${ids.length} ç¯‡æ–‡ç« ï¼Ÿ`)) {
                return;
            }
            
            fetch('/admin/articles/bulk/unpublish/', {
                method: 'POST',
                headers: {
                    'X-CSRFToken': csrftoken,
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: new URLSearchParams({ 'article_ids[]': ids })
            })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    showToast(data.message, 'success');
                    setTimeout(() => location.reload(), 1500);
                } else {
                    showToast(data.message || 'æ“ä½œå¤±è´¥', 'error');
                }
            })
            .catch(err => {
                showToast('ç½‘ç»œé”™è¯¯', 'error');
            });
        }
        
        function showChannelModal() {
            const ids = getSelectedIds();
            if (ids.length === 0) {
                showToast('è¯·å…ˆé€‰æ‹©æ–‡ç« ', 'error');
                return;
            }
            showModal('channel-modal');
        }
        
        function confirmChangeChannel() {
            const ids = getSelectedIds();
            const channelId = document.getElementById('target-channel').value;
            
            if (!channelId) {
                showToast('è¯·é€‰æ‹©ç›®æ ‡é¢‘é“', 'error');
                return;
            }
            
            fetch('/admin/articles/bulk/change-channel/', {
                method: 'POST',
                headers: {
                    'X-CSRFToken': csrftoken,
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: new URLSearchParams({ 'article_ids[]': ids, 'channel_id': channelId })
            })
            .then(res => res.json())
            .then(data => {
                closeModal('channel-modal');
                if (data.success) {
                    showToast(data.message, 'success');
                    setTimeout(() => location.reload(), 1500);
                } else {
                    showToast(data.message || 'æ“ä½œå¤±è´¥', 'error');
                }
            })
            .catch(err => {
                closeModal('channel-modal');
                showToast('ç½‘ç»œé”™è¯¯', 'error');
            });
        }
        
        function showTagsModal() {
            const ids = getSelectedIds();
            if (ids.length === 0) {
                showToast('è¯·å…ˆé€‰æ‹©æ–‡ç« ', 'error');
                return;
            }
            showModal('tags-modal');
        }
        
        function confirmAddTags() {
            const ids = getSelectedIds();
            const tags = document.getElementById('tags-input').value;
            
            if (!tags.trim()) {
                showToast('è¯·è¾“å…¥æ ‡ç­¾', 'error');
                return;
            }
            
            fetch('/admin/articles/bulk/add-tags/', {
                method: 'POST',
                headers: {
                    'X-CSRFToken': csrftoken,
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: new URLSearchParams({ 'article_ids[]': ids, 'tags': tags })
            })
            .then(res => res.json())
            .then(data => {
                closeModal('tags-modal');
                if (data.success) {
                    showToast(data.message, 'success');
                    setTimeout(() => location.reload(), 1500);
                } else {
                    showToast(data.message || 'æ“ä½œå¤±è´¥', 'error');
                }
            })
            .catch(err => {
                closeModal('tags-modal');
                showToast('ç½‘ç»œé”™è¯¯', 'error');
            });
        }
        
        function showPublishTimeModal() {
            const ids = getSelectedIds();
            if (ids.length === 0) {
                showToast('è¯·å…ˆé€‰æ‹©æ–‡ç« ', 'error');
                return;
            }
            showModal('publish-time-modal');
        }
        
        function confirmSetPublishTime() {
            const ids = getSelectedIds();
            const publishTime = document.getElementById('publish-time-input').value;
            
            // è½¬æ¢ä¸º YYYY-MM-DD HH:MM æ ¼å¼
            let formattedTime = '';
            if (publishTime) {
                formattedTime = publishTime.replace('T', ' ');
            }
            
            fetch('/admin/articles/bulk/set-publish-time/', {
                method: 'POST',
                headers: {
                    'X-CSRFToken': csrftoken,
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: new URLSearchParams({ 'article_ids[]': ids, 'publish_at': formattedTime })
            })
            .then(res => res.json())
            .then(data => {
                closeModal('publish-time-modal');
                if (data.success) {
                    showToast(data.message, 'success');
                    setTimeout(() => location.reload(), 1500);
                } else {
                    showToast(data.message || 'æ“ä½œå¤±è´¥', 'error');
                }
            })
            .catch(err => {
                closeModal('publish-time-modal');
                showToast('ç½‘ç»œé”™è¯¯', 'error');
            });
        }
        
        function bulkDelete() {
            const ids = getSelectedIds();
            if (ids.length === 0) {
                showToast('è¯·å…ˆé€‰æ‹©æ–‡ç« ', 'error');
                return;
            }
            
            if (!confirm(`âš ï¸ ç¡®è®¤åˆ é™¤é€‰ä¸­çš„ ${ids.length} ç¯‡è‰ç¨¿ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼`)) {
                return;
            }
            
            fetch('/admin/articles/bulk/delete/', {
                method: 'POST',
                headers: {
                    'X-CSRFToken': csrftoken,
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: new URLSearchParams({ 'article_ids[]': ids })
            })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    showToast(data.message, 'success');
                    setTimeout(() => location.reload(), 1500);
                } else {
                    showToast(data.message || 'æ“ä½œå¤±è´¥', 'error');
                }
            })
            .catch(err => {
                showToast('ç½‘ç»œé”™è¯¯', 'error');
            });
        }
        
        function bulkExport() {
            const ids = getSelectedIds();
            if (ids.length === 0) {
                showToast('è¯·å…ˆé€‰æ‹©æ–‡ç« ', 'error');
                return;
            }
            
            // æ„å»ºå¯¼å‡ºURL
            const params = new URLSearchParams();
            ids.forEach(id => params.append('article_ids', id));
            window.location.href = `/admin/articles/bulk/export/?${params.toString()}`;
            showToast('æ­£åœ¨å¯¼å‡º...', 'success');
        }
    </script>
</body>
</html>

