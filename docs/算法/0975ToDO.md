## TODO - 搜索体系建设（对标今日头条）

### P0｜打通与修复（本周）
- [x] 修复前端 `/api/search` 400 问题（参数统一：`q`、`order`；联调 CMS `/api/articles`）
- [x] 返回结构补齐：高亮字段、来源、频道、封面图占位
- [x] 添加 CDN 缓存头与超时/降级策略
- [x] SERP 页面：结果高亮、安全渲染、空结果兜底（热门/改写建议）
- [x] 埋点：`search_query`、`search_click`、`serp_dwell` 上报（ClickHouse）

### P1｜体验增强（下周）
- [x] 自动补全 Suggest API（Next.js + Django）与前端下拉交互
- [x] 热搜榜 Trending API（ClickHouse 滑窗：5m/1h/24h；频道维度）与前端展示
- [x] 搜索历史（本地 10–20 条，可清空；登录态可选落库）
- [x] SERP 筛选与排序：时间（24h/7d/30d）、频道、地区；排序（相关度/最新/热度）
- [x] 相关搜索（co-click/co-query 规则兜底）
- [x] 查询防抖与请求合并（150–250ms），重复/空查询拦截

### P2｜效果与智能（本月）
- [ ] 排序融合：相关度 + 新鲜度 + 热度 + 个性化（匿名兴趣）+ 点击提升
- [ ] 拼写纠错与同义词扩展（词典与管理流程）
- [ ] 游标分页与稳定去重（避免深翻页性能退化）
- [ ] 监控面板：QPS、成功率、P95、无结果率、建议点击率、改写率
- [ ] A/B 实验框架：排序权重与位置偏置评估

### OpenSearch 与数据
- [ ] 建立 `articles` 检索模板（multi_match、filter、highlight、排序）
- [ ] 建立 `suggestions` 索引（edge_ngram/completion）与热词融合逻辑
- [ ] 同义词/停用词词典按站点管理与加载流程

### 安全与风控
- [ ] 频率限制（IP/设备/用户）与参数校验
- [ ] 反爬策略（Header 校验、行为评分、必要时验证码）
- [ ] 敏感词过滤与合规提示

### 验收清单（抽样用例）
- [x] 输入"科技"显示建议，下键选择与回车均生效
- [x] SERP 默认相关度排序并有高亮；切换"近7天/最新优先/财经频道"有效
- [x] 空结果出现改写建议与热门兜底
- [x] 热搜榜展示近1小时榜单并标注"飙升/新"
- [ ] 点击第3条后返回同查询，位置有轻微提升（点击提升）

### 其他待办
- [ ] 修复"今日头条"模块数据：更新 OpenSearch 数据新鲜度（`compute_headlines` 数据源与时间窗口）

---

## 🚨 生产就绪 - 必要完成清单

### 安全与性能（必须）
- [ ] **频率限制**: API请求限流（IP/用户维度）
- [ ] **参数校验**: 搜索查询长度、特殊字符过滤
- [ ] **敏感词过滤**: 搜索词与结果内容合规检查
- [ ] **游标分页**: 替换OFFSET分页，避免深翻页性能问题

### 用户体验完整性（重要）
- [ ] **点击提升**: 搜索结果点击反馈到排序算法
- [ ] **基础监控**: 搜索QPS、成功率、P95响应时间

### 数据质量（可选但建议）
- [ ] **排序融合**: 相关度+时间+热度权重调优
- [ ] **中文拼写纠错**: 常见错别字自动修正

### 额外完成的功能（超出原计划）
- [x] 智能搜索框全局集成（导航栏搜索框升级）
- [x] 搜索框查询保持与清空按钮
- [x] 中文分词集成（jieba + TF-IDF）
- [x] 热搜榜初始化命令（基于文章内容生成）
- [x] 热搜榜关键词多样性优化（长词权重加成）
- [x] 搜索页面响应式设计优化（统一max-w-7xl宽度）
- [x] 频道选择状态修复（搜索页无默认选中）
- [x] SSR兼容性修复（window对象安全访问）
- [x] ClickHouse数据记录与查询优化


