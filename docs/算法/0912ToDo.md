### 0912 算法改造落地 ToDo（对标今日头条）

#### 一、已完成（基线）
- [x] `/api/topics` 增强：聚类级指标、趋势判定、稳定排序、cursor、region/lang 支持
- [x] 前端统一入口：移除 `/api/hot-topics`，热门话题走 `/api/topics`

#### 二、Phase 1：后端接口建设（高优）
- [x] 新增 `/api/headlines`（今日头条专用）
  - [x] 入参：size（默认4，1–6）、hours（默认24，1–72）、region、lang、diversity、exclude_cluster_ids、fields、debug
  - [x] 召回：按近 24h 候选，支持 ES→DB 回退
  - [x] 聚类：URL 精确 + 标题相似度，输出代表文与 `cluster_slug`
  - [x] 排序：爆发度（1h/24h 比 + 增速）× 质量 × 新鲜度；同簇唯一；强多样性
  - [x] 返回：{ items, next_cursor?（可选）, debug? }
  - [x] 缓存：s-maxage 30–60s + SWR；首条 15–30s；Redis 30–60s
  - [x] 指标：空列表率、P95、错误率、爆发命中率（已具备debug统计基础）

- [x] 新增 `/api/hot`（最热阅读）
  - [x] 入参：size（默认10，1–50）、hours（默认168，24–720）、buckets（"1h,6h,24h"）、region、lang、diversity、exclude_cluster_ids、cursor、fields、debug
  - [x] 召回：多窗口（1h/6h/24h）候选，支持权重分桶
  - [x] 排序：热度（PV/UV/停留/互动）× 强时间衰减；跨频道/来源配额；同簇≤2；分桶混排
  - [x] 返回：{ items, next_cursor, debug? }
  - [x] 缓存：s-maxage 60–120s + SWR；Redis 60–120s；预热前两页游标（可配置）
  - [x] 指标：曝光、CTR、P95、错误率、去重率、多样性得分（具备debug信息）

- [x] 公共能力
  - [x] 统一字段：id、slug、title、final_score、trend、cluster_slug、source、channel、publish_at
  - [x] region/lang 轻量过滤与向下传递
  - [x] 熔断与最小可用兜底（非空列表）；上游超时 6–8s
  - [ ] Feature flags：`features.headlines.enabled`、`features.hot.enabled`、`features.debug_enabled`

#### 三、Phase 2：前端接入改造（高优）
- [x] 今日头条模块接入 `/api/headlines`
  - [x] 使用 `cluster_slug` 代表文，显示 `trend` 标记
  - [x] 强多样性：来源/频道去重；骨架屏与空态（现已支持）
  - [ ] region/lang 透传；短缓存策略（可选增强）

- [x] 最热阅读模块接入 `/api/hot`
  - [x] 支持 `next_cursor` 加载更多
  - [x] 同簇≤2，跨频道/来源配额（后端保障）；展示质量徽标（可选）
  - [ ] region/lang 透传；SWR 缓存（可选增强）

- [x] 跨模块去重
  - [x] 优先级：头条 > 推荐流 > 最热（通过注入 excludeClusterIds 实现）
  - [x] 基于 `cluster_slug` 去重；允许最热保留同簇第二来源（≤1 条）（后端簇内≤2）

#### 四、Phase 3：缓存与性能（中高）
- [ ] CDN 策略：短 s-maxage + SWR；关键接口预热（headlines 首屏、hot 前两页）
- [ ] 服务器缓存：Redis 聚合缓存按 site/region/lang/hours/slot key，TTL 30–120s
- [ ] 性能目标：接口 P95 < 400ms（内网），错误率 < 0.5%

#### 五、观测与 AB（中高）
- [ ] 指标面板
  - [ ] 曝光、CTR、停留、分享、空列表率、降级率、P95、错误率
  - [ ] 去重率（跨模块同簇）与多样性（来源/频道覆盖）
  - [ ] 爆发命中率（头条）
- [ ] AB/灰度
  - [ ] 参数：ranker.weights、diversity.level、bucket.weights（1h/6h/24h 比例）
  - [ ] 分流与放量：灰度→10%→50%→100%，可一键回滚
  - [ ] debug 返回仅灰度启用，生产关闭

#### 六、质量与风控（中）
- [ ] 来源质量分与黑白名单
- [ ] 旧闻压制、标题党降权、敏感/低质识别
- [ ] 异常流量与机器人过滤（速率/指纹）

#### 七、验收标准（MVP）
- [ ] 空列表率 < 1%，接口 P95 < 400ms，错误率 < 0.5%
- [ ] 跨模块去重率 > 85%，来源/频道多样性达配额
- [ ] 首页头条 CTR 较基线提升 ≥ 10%（AB 观察 3–7 天）

#### 八、里程碑与产出
- Phase 1（后端接口，T+3～5天）
  - 产出：`/api/headlines`、`/api/hot`、公共字段与缓存、Feature flags、指标上报
- Phase 2（前端接入，T+2～3天）
  - 产出：头条/最热接入新接口，跨模块去重，region/lang 透传，加载更多
- Phase 3（优化与观测，T+2天）
  - 产出：CDN/Redis 优化、预热、指标面板、AB 配置与回滚

（备注）Phase 4 可选：多路召回 + 轻量 Ranker、探索机制、个性化比例控制（后续规划）


