# é¦–é¡µè½®æ’­æ¿å—æŠ€æœ¯æ–‡æ¡£

## ğŸ“‹ æ¦‚è¿°

é¦–é¡µè½®æ’­æ¿å—(Hero Carousel)æ˜¯å…šæŠ¥å¤´æ¡ç½‘ç«™çš„é‡è¦è§†è§‰ç„¦ç‚¹ï¼Œç”¨äºå±•ç¤ºæœ€é‡è¦çš„æ–°é—»å†…å®¹ã€‚è¯¥ç»„ä»¶é‡‡ç”¨å“åº”å¼è®¾è®¡ï¼Œæ”¯æŒå¤šç§é«˜åº¦æ¨¡å¼å’Œäº¤äº’æ–¹å¼ï¼Œç¡®ä¿åœ¨ä¸åŒåœºæ™¯ä¸‹éƒ½èƒ½æä¾›æœ€ä½³çš„ç”¨æˆ·ä½“éªŒã€‚

## ğŸ¯ è®¾è®¡ç†å¿µ

### æ ¸å¿ƒåŸåˆ™
- **å†…å®¹ä¸ºç‹**ï¼šåªå±•ç¤ºç¼–è¾‘ç²¾é€‰çš„é‡è¦å†…å®¹(`is_hero=True`)
- **ä¼˜é›…é™çº§**ï¼šæ²¡æœ‰Heroå†…å®¹æ—¶éšè—ç»„ä»¶ï¼Œé¿å…ç©ºç™½å±•ç¤º
- **å“åº”å¼è®¾è®¡**ï¼šé€‚é…æ¡Œé¢ã€å¹³æ¿ã€æ‰‹æœºç­‰ä¸åŒè®¾å¤‡
- **æ€§èƒ½ä¼˜å…ˆ**ï¼šå›¾ç‰‡æ‡’åŠ è½½ã€ç¼“å­˜ä¼˜åŒ–ã€äº¤äº’æµç•…
- **æ— éšœç¢æ”¯æŒ**ï¼šé”®ç›˜å¯¼èˆªã€ARIAæ ‡ç­¾ã€å¯¹æ¯”åº¦è§„èŒƒ

### ä½¿ç”¨åœºæ™¯
- âœ… **é‡å¤§æ–°é—»å‘å¸ƒ**ï¼šçªå‘äº‹ä»¶ã€æ”¿ç­–å‘å¸ƒã€é‡è¦ä¼šè®®
- âœ… **ä¸“é¢˜å†…å®¹æ¨å¹¿**ï¼šæ·±åº¦æŠ¥é“ã€ç³»åˆ—æ–‡ç« ã€ç‰¹åˆ«ç­–åˆ’  
- âœ… **æ´»åŠ¨ç›´æ’­é¢„å‘Š**ï¼šé‡è¦ä¼šè®®ã€æ–°é—»å‘å¸ƒä¼šç›´æ’­
- âŒ **æ—¥å¸¸æ–°é—»æµ**ï¼šæ™®é€šæ–°é—»åº”ä½¿ç”¨TopStoriesæ¿å—

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   é¡µé¢é›†æˆ      â”‚    â”‚   Heroç»„ä»¶      â”‚    â”‚   æ•°æ®è·å–      â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚   page.tsx      â”‚â”€â”€â”€â–¶â”‚ HeroCarousel    â”‚â”€â”€â”€â–¶â”‚ getHeroItems()  â”‚
â”‚ (æ¡ä»¶æ¸²æŸ“)      â”‚    â”‚   (.tsx)        â”‚    â”‚   (.utils.ts)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                        â”‚
                               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                               â”‚                        â–¼                        â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   API Routes    â”‚    â”‚   Django API    â”‚    â”‚   Wagtail CMS   â”‚
                    â”‚ /api/news?hero  â”‚    â”‚ /api/articles/  â”‚    â”‚   (is_hero)     â”‚
                    â”‚  (Next.js)      â”‚    â”‚   (Django)      â”‚    â”‚                 â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æŠ€æœ¯æ ˆ
- **å‰ç«¯ç»„ä»¶**: React 18 + TypeScript + Next.js 14
- **æ ·å¼æ¡†æ¶**: Tailwind CSS + CSS Modules
- **å›¾ç‰‡ä¼˜åŒ–**: Next.js Imageç»„ä»¶ + WebPæ”¯æŒ
- **çŠ¶æ€ç®¡ç†**: React Hooks (useState, useEffect, useCallback)
- **äº¤äº’å¢å¼º**: è§¦æ‘¸æ»‘åŠ¨ã€é”®ç›˜å¯¼èˆªã€è‡ªåŠ¨æ’­æ”¾æ§åˆ¶

## ğŸ”§ æ ¸å¿ƒç»„ä»¶

### 1. ä¸»ç»„ä»¶ (HeroCarousel.tsx)

#### æ¥å£è®¾è®¡
```typescript
export interface HeroItem {
  id: string;
  title: string;
  excerpt?: string;
  image_url?: string;
  publish_time?: string;
  author?: string;
  source?: string;
  channel?: { id: string; name: string; slug: string; };
  topic?: { id: string; name: string; slug: string; };
  slug: string;
  is_breaking?: boolean;    // çªå‘æ–°é—»
  is_live?: boolean;        // ç›´æ’­å†…å®¹
  is_event_mode?: boolean;  // äº‹ä»¶æ¨¡å¼
  media_type?: 'image' | 'video' | 'data';
  tags?: string[];
}

export interface HeroCarouselProps {
  items: HeroItem[];
  // é«˜åº¦æ¨¡å¼é…ç½®
  heightMode?: 'compact' | 'standard' | 'takeover';
  hasRightRail?: boolean;
  maxHeightVh?: number;
  // äº¤äº’é…ç½®
  autoPlay?: boolean;
  autoPlayInterval?: number;
  showDots?: boolean;
  showArrows?: boolean;
  className?: string;
  onItemClick?: (item: HeroItem) => void;
}
```

#### æ ¸å¿ƒç‰¹æ€§

**1. æ™ºèƒ½é«˜åº¦æ¨¡å¼**
```typescript
const getHeightMode = useCallback((): HeroHeightMode => {
  // æ£€æŸ¥æ˜¯å¦æœ‰äº‹ä»¶æ¨¡å¼çš„å†…å®¹
  const hasEventContent = validItems.some(item => 
    item.is_event_mode || item.is_live
  );
  
  if (hasEventContent) {
    return 'takeover'; // 85-95svh
  }
  
  // æ£€æŸ¥æ˜¯å¦æœ‰é‡è¦å†…å®¹
  const hasImportantContent = validItems.some(item => 
    item.is_breaking
  );
  
  if (hasImportantContent) {
    return 'standard'; // 48-60vh
  }
  
  return 'compact'; // 32-40vh
}, [validItems]);
```

**2. è‡ªåŠ¨æ’­æ”¾æ§åˆ¶**
```typescript
// è‡ªåŠ¨æ’­æ”¾é€»è¾‘
useEffect(() => {
  if (!isPlaying || isPaused || totalItems <= 1) {
    if (intervalRef.current) {
      clearInterval(intervalRef.current);
      intervalRef.current = null;
    }
    return;
  }

  intervalRef.current = setInterval(() => {
    setCurrentIndex(prev => (prev + 1) % totalItems);
  }, autoPlayInterval);

  return () => {
    if (intervalRef.current) {
      clearInterval(intervalRef.current);
      intervalRef.current = null;
    }
  };
}, [isPlaying, isPaused, totalItems, autoPlayInterval]);
```

**3. è§¦æ‘¸æ»‘åŠ¨æ”¯æŒ**
```typescript
const handleTouchStart = (e: React.TouchEvent) => {
  setTouchEnd(null);
  setTouchStart(e.targetTouches[0].clientX);
};

const handleTouchMove = (e: React.TouchEvent) => {
  setTouchEnd(e.targetTouches[0].clientX);
};

const handleTouchEnd = () => {
  if (!touchStart || !touchEnd) return;
  
  const distance = touchStart - touchEnd;
  const isLeftSwipe = distance > 50;
  const isRightSwipe = distance < -50;

  if (isLeftSwipe) {
    setCurrentIndex(prev => (prev + 1) % totalItems);
  } else if (isRightSwipe) {
    setCurrentIndex(prev => (prev - 1 + totalItems) % totalItems);
  }
};
```

### 2. æ•°æ®è·å– (HeroCarousel.utils.ts)

#### æ ¸å¿ƒå‡½æ•°
```typescript
/**
 * è·å– Hero è½®æ’­æ•°æ®
 * åªä½¿ç”¨ä¸“é—¨æ ‡è®°ä¸ºHeroçš„å†…å®¹ï¼Œæ²¡æœ‰æ•°æ®æ—¶ä¸æ˜¾ç¤ºHeroç»„ä»¶
 */
export async function getHeroItems(limit: number = 5): Promise<HeroItem[]> {
  try {
    // ğŸ¬ è·å–ä¸“é—¨æ ‡è®°ä¸ºHeroçš„å†…å®¹
    console.log('ğŸ¬ HeroCarousel: å°è¯•è·å–Heroä¸“ç”¨å†…å®¹...');
    const heroResponse = await getNews('hero', 1, limit);
    
    if (heroResponse.data && heroResponse.data.length > 0) {
      console.log(`ğŸ¬ è·å–åˆ° ${heroResponse.data.length} æ¡Heroä¸“ç”¨å†…å®¹`);
      const heroItems = heroResponse.data
        .filter(item => item.cover?.url || item.image_url) // ç¡®ä¿æœ‰å°é¢å›¾
        .map(item => transformToHeroItem(item));
      
      console.log(`ğŸ¬ è¿‡æ»¤åHeroå†…å®¹: ${heroItems.length} æ¡`);
      return heroItems;
    }
  } catch (error) {
    console.warn('ğŸš« Failed to fetch hero-specific content:', error);
  }
  
  // ğŸš« æ²¡æœ‰Heroæ•°æ®æ—¶è¿”å›ç©ºæ•°ç»„ï¼Œä¸æ˜¾ç¤ºHeroç»„ä»¶
  console.log('ğŸš« HeroCarousel: æ²¡æœ‰Heroæ•°æ®ï¼Œä¸æ˜¾ç¤ºHeroç»„ä»¶');
  return [];
}
```

#### æ•°æ®è½¬æ¢
```typescript
function transformToHeroItem(item: any): HeroItem {
  return {
    id: item.id.toString(),
    title: item.title,
    excerpt: item.excerpt || item.summary || '',
    image_url: item.cover?.url || item.image_url,
    publish_time: item.publish_at || item.first_published_at || item.created_at,
    author: item.author_name || item.author || '',
    source: item.source_site?.name || item.external_site?.name || 'æœ¬ç«™',
    channel: item.channel ? {
      id: item.channel.slug || item.channel.id.toString(),
      name: item.channel.name,
      slug: item.channel.slug || item.channel.id.toString()
    } : undefined,
    slug: item.slug || `article-${item.id}`,
    is_breaking: item.is_featured || false,
    is_live: item.is_live || false,
    is_event_mode: item.is_event_mode || false,
    media_type: item.has_video ? 'video' : 'image',
    tags: item.tags || [],
  };
}
```

### 3. APIé›†æˆ

#### Next.js APIè·¯ç”± (`/api/news/route.ts`)
```typescript
// ç‰¹æ®Šå¤„ç†ï¼šHeroè½®æ’­æ•°æ®
if (channel === "hero") {
  const heroUrl = endpoints.buildUrl(
    endpoints.getCmsEndpoint('/api/articles/'),
    {
      site: getMainSite().hostname,
      page,
      size: limit,
      is_hero: "true",
      order: "-weight,-publish_at",
      include: "cover,channel"
    }
  );

  const response = await fetch(heroUrl, endpoints.createFetchConfig({
    timeout: 5000,
    next: {
      revalidate: 30, // Heroå†…å®¹ç¼“å­˜30ç§’ï¼Œä¾¿äºå¿«é€Ÿæ›´æ–°
      tags: [`hero:${getMainSite().hostname}`, "articles:hero"],
    },
  }));
```

**ç¼“å­˜ç­–ç•¥**:
- **30ç§’çŸ­ç¼“å­˜**: ç¡®ä¿ç®¡ç†å‘˜ç¼–è¾‘åå¿«é€Ÿç”Ÿæ•ˆ
- **æ ‡ç­¾ç¼“å­˜**: æ”¯æŒç²¾ç¡®çš„ç¼“å­˜å¤±æ•ˆ
- **å®¹é”™å¤„ç†**: APIå¤±è´¥æ—¶ä¼˜é›…é™çº§

## ğŸ¨ é«˜åº¦æ¨¡å¼è¯¦è§£

### ä¸‰ç§é«˜åº¦æ¨¡å¼

| æ¨¡å¼ | é€‚ç”¨åœºæ™¯ | æ¡Œé¢ç«¯é«˜åº¦ | å¹³æ¿ç«¯ | ç§»åŠ¨ç«¯ | è§¦å‘æ¡ä»¶ |
|------|----------|------------|--------|--------|----------|
| **Compact** | æ—¥å¸¸é¢‘é“å¤´æ¡ + å³ä¾§æ å­˜åœ¨ | 32â€“40vh | 28â€“36vh | 36â€“44svh | é»˜è®¤æ¨¡å¼ |
| **Standard** | é‡è¦å¤´æ¡ï¼Œä¿æŒä¸‹æ–¹å¯è§ | 48â€“60vh | 42â€“54vh | 45â€“55svh | `is_breaking=true` |
| **Takeover** | ç›´æ’­/çªå‘äº‹ä»¶/æ•°æ®å¤§å± | 85â€“95svh | 80â€“90svh | 80â€“90svh | `is_event_mode=true`æˆ–`is_live=true` |

### CSSå®ç°
```css
/* Compactæ¨¡å¼ */
.hero-compact {
  height: clamp(300px, 36vh, 420px);
}

/* Standardæ¨¡å¼ */  
.hero-standard {
  height: clamp(420px, 56vh, 680px);
}

/* Takeoveræ¨¡å¼ */
.hero-takeover {
  height: clamp(600px, 90svh, calc(100svh - 80px));
}

/* å“åº”å¼æ–­ç‚¹ */
@media (max-width: 1023px) {
  .hero-compact { height: clamp(280px, 32vh, 380px); }
  .hero-standard { height: clamp(380px, 48vh, 560px); }
  .hero-takeover { height: clamp(500px, 85svh, calc(100svh - 60px)); }
}
```

### é«˜åº¦å†³ç­–é€»è¾‘
```typescript
// 1. æ£€æŸ¥äº‹ä»¶æ¨¡å¼ â†’ Takeover
if (item.is_event_mode || item.is_live) return 'takeover';

// 2. æ£€æŸ¥çªå‘æ–°é—» â†’ Standard  
if (item.is_breaking) return 'standard';

// 3. é»˜è®¤ â†’ Compact
return 'compact';
```

## ğŸ“± å“åº”å¼è®¾è®¡

### æ–­ç‚¹é…ç½®
```typescript
const breakpoints = {
  mobile: '0px',
  tablet: '768px', 
  desktop: '1024px',
  wide: '1440px'
};
```

### å¸ƒå±€é€‚é…
```css
/* ç§»åŠ¨ç«¯ï¼šå•æ å †å  */
.hero-carousel {
  @apply relative w-full;
}

/* å¹³æ¿ç«¯ï¼šä¼˜åŒ–è§¦æ‘¸äº¤äº’ */
@media (min-width: 768px) {
  .hero-carousel {
    @apply touch-pan-x; /* æ”¯æŒæ°´å¹³æ»‘åŠ¨ */
  }
}

/* æ¡Œé¢ç«¯ï¼šé¼ æ ‡æ‚¬åœæ•ˆæœ */
@media (min-width: 1024px) {
  .hero-carousel:hover .hero-controls {
    @apply opacity-100;
  }
}
```

### å›¾ç‰‡ä¼˜åŒ–
```typescript
// Next.js Imageç»„ä»¶é…ç½®
<Image
  src={item.image_url}
  alt={item.title}
  fill
  priority={index === 0} // é¦–å¼ å›¾ç‰‡ä¼˜å…ˆåŠ è½½
  sizes="(max-width: 768px) 100vw, (max-width: 1200px) 66vw, 50vw"
  className="object-cover"
  onLoad={() => setImageLoaded(prev => ({ ...prev, [index]: true }))}
/>
```

## ğŸš€ æ€§èƒ½ä¼˜åŒ–

### æ‡’åŠ è½½ç­–ç•¥
```typescript
// å›¾ç‰‡æ‡’åŠ è½½
const [imageLoaded, setImageLoaded] = useState<Record<number, boolean>>({});

// åªé¢„åŠ è½½å½“å‰å’Œä¸‹ä¸€å¼ å›¾ç‰‡
const shouldPreload = (index: number) => {
  return index === currentIndex || 
         index === (currentIndex + 1) % totalItems;
};
```

### ç¼“å­˜ç­–ç•¥
```typescript
// 1. Next.js APIç¼“å­˜ (30ç§’)
next: { revalidate: 30 }

// 2. æµè§ˆå™¨ç¼“å­˜
headers: {
  'Cache-Control': 'public, s-maxage=30, stale-while-revalidate=60'
}

// 3. ç»„ä»¶çº§ç¼“å­˜
const memoizedHeroItems = useMemo(() => 
  items.filter(item => item.image_url), 
  [items]
);
```

### äº¤äº’ä¼˜åŒ–
```typescript
// é˜²æŠ–å¤„ç†
const debouncedNavigation = useCallback(
  debounce((direction: 'prev' | 'next') => {
    if (direction === 'next') {
      setCurrentIndex(prev => (prev + 1) % totalItems);
    } else {
      setCurrentIndex(prev => (prev - 1 + totalItems) % totalItems);
    }
  }, 100),
  [totalItems]
);
```

## ğŸ› ï¸ æ•°æ®ç®¡ç†

### å†…å®¹åˆ›å»º (Wagtail Admin)

#### ç®¡ç†å‘˜æ“ä½œ
1. **è¿›å…¥æ–‡ç« ç¼–è¾‘**: `http://localhost:8000/admin/pages/`
2. **åˆ›å»ºæ–°æ–‡ç« **: é€‰æ‹© "Add ArticlePage"
3. **è®¾ç½®Heroæ ‡è¯†**: å‹¾é€‰ `is_hero` å­—æ®µ
4. **ä¸Šä¼ å°é¢å›¾**: å¿…é¡»æä¾›é«˜è´¨é‡å°é¢å›¾ (å»ºè®®16:9æ¯”ä¾‹)
5. **è®¾ç½®æƒé‡**: `weight` å­—æ®µæ§åˆ¶æ˜¾ç¤ºä¼˜å…ˆçº§
6. **å‘å¸ƒå†…å®¹**: ç‚¹å‡» "Publish" ä½¿å†…å®¹ç”Ÿæ•ˆ

#### å­—æ®µé…ç½®
```python
# ArticlePageæ¨¡å‹ä¸­çš„Heroç›¸å…³å­—æ®µ
class ArticlePage(Page):
    is_hero = models.BooleanField(default=False, verbose_name="æ˜¯å¦ä¸ºHeroè½®æ’­")
    weight = models.IntegerField(default=0, verbose_name="æƒé‡ (æ•°å­—è¶Šå¤§è¶Šé å‰)")
    is_breaking = models.BooleanField(default=False, verbose_name="çªå‘æ–°é—»")
    is_live = models.BooleanField(default=False, verbose_name="ç›´æ’­å†…å®¹") 
    is_event_mode = models.BooleanField(default=False, verbose_name="äº‹ä»¶æ¨¡å¼")
    
    # å°é¢å›¾ (Heroå¿…éœ€)
    cover = models.ForeignKey(
        'core.CustomImage',
        null=True, blank=True,
        on_delete=models.SET_NULL,
        verbose_name="å°é¢å›¾"
    )
```

### æ‰¹é‡å¯¼å…¥å·¥å…·

#### ç®¡ç†å‘½ä»¤ä½¿ç”¨
```bash
# åŸºç¡€å¯¼å…¥
python manage.py import_hero_data

# æŒ‡å®šç«™ç‚¹
python manage.py import_hero_data --site=aivoya.com

# æ¸…é™¤ç°æœ‰æ•°æ®åå¯¼å…¥
python manage.py import_hero_data --replace

# é¢„è§ˆæ¨¡å¼ (ä¸å®é™…åˆ›å»ºæ•°æ®)
python manage.py import_hero_data --dry-run
```

#### å¯¼å…¥æµç¨‹
```python
# 1. è·å–mockæ•°æ®
hero_data = self.get_mock_hero_data()

# 2. ä¸‹è½½å¤–éƒ¨å›¾ç‰‡
image_path = self.download_image(item['image_url'])

# 3. ä¸Šä¼ åˆ°MinIOå¹¶åˆ›å»ºWagtailå›¾ç‰‡è®°å½•
image_record = self.create_wagtail_image(image_path, item['title'])

# 4. åˆ›å»ºArticlePage
article = ArticlePage(
    title=item['title'],
    slug=item['slug'],
    excerpt=item['excerpt'],
    is_hero=True,
    weight=item.get('weight', 50),
    cover=image_record,
    # ... å…¶ä»–å­—æ®µ
)

# 5. å…³è”åˆ°ç«™ç‚¹å¹¶å‘å¸ƒ
article.save_revision().publish()
```

## ğŸ“Š ç›‘æ§æŒ‡æ ‡

### æ€§èƒ½æŒ‡æ ‡
- **ç»„ä»¶æ¸²æŸ“æ—¶é—´**: < 100ms
- **å›¾ç‰‡åŠ è½½æ—¶é—´**: é¦–å¼ å›¾ç‰‡ < 1.5sï¼Œå…¶ä»–å›¾ç‰‡ < 3s
- **äº¤äº’å“åº”æ—¶é—´**: åˆ‡æ¢åŠ¨ç”» < 300ms
- **å†…å­˜å ç”¨**: å•ä¸ªHeroç»„ä»¶ < 50MB

### ä¸šåŠ¡æŒ‡æ ‡
- **å±•ç¤ºç‡**: Heroç»„ä»¶æ˜¾ç¤ºæˆåŠŸç‡ > 98%
- **ç‚¹å‡»ç‡**: Heroè½®æ’­çš„CTRæŒ‡æ ‡
- **åœç•™æ—¶é—´**: ç”¨æˆ·åœ¨HeroåŒºåŸŸçš„å¹³å‡åœç•™æ—¶é—´
- **æ»‘åŠ¨ç‡**: ç”¨æˆ·ä¸»åŠ¨åˆ‡æ¢çš„æ¯”ä¾‹

### ç›‘æ§ä»£ç 
```typescript
// æ€§èƒ½ç›‘æ§
const [performanceMetrics, setPerformanceMetrics] = useState({
  renderTime: 0,
  imageLoadTime: 0,
  interactionTime: 0
});

// æ¸²æŸ“æ—¶é—´ç›‘æ§
useEffect(() => {
  const startTime = performance.now();
  
  const observer = new PerformanceObserver((list) => {
    for (const entry of list.getEntries()) {
      if (entry.name === 'hero-carousel-render') {
        setPerformanceMetrics(prev => ({
          ...prev,
          renderTime: entry.duration
        }));
      }
    }
  });
  
  observer.observe({ entryTypes: ['measure'] });
  
  return () => observer.disconnect();
}, []);

// ç”¨æˆ·äº¤äº’ç›‘æ§
const trackHeroInteraction = useCallback((action: string, item: HeroItem) => {
  analytics.track('hero_interaction', {
    action,
    item_id: item.id,
    item_title: item.title,
    position: currentIndex,
    total_items: totalItems,
    height_mode: actualHeightMode,
    timestamp: Date.now()
  });
}, [currentIndex, totalItems, actualHeightMode]);
```

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. Heroç»„ä»¶ä¸æ˜¾ç¤º
**ç°è±¡**: é¡µé¢æ­£å¸¸åŠ è½½ï¼Œä½†HeroåŒºåŸŸç©ºç™½

**æ’æŸ¥æ­¥éª¤**:
```bash
# 1. æ£€æŸ¥åç«¯API
curl "http://localhost:8000/api/articles/?is_hero=true&site=aivoya.com"

# 2. æ£€æŸ¥å‰ç«¯APIä»£ç†  
curl "http://localhost:3001/api/news?channel=hero"

# 3. æ£€æŸ¥æ•°æ®åº“
python manage.py shell
>>> from apps.news.models import ArticlePage
>>> ArticlePage.objects.filter(is_hero=True).count()
```

**è§£å†³æ–¹æ¡ˆ**:
- ç¡®ä¿è‡³å°‘æœ‰ä¸€æ¡ `is_hero=True` çš„æ–‡ç« 
- æ£€æŸ¥æ–‡ç« æ˜¯å¦å·²å‘å¸ƒ (`live=True`)
- éªŒè¯æ–‡ç« æœ‰æœ‰æ•ˆçš„å°é¢å›¾

#### 2. å›¾ç‰‡åŠ è½½å¤±è´¥
**ç°è±¡**: Heroæ˜¾ç¤ºï¼Œä½†å›¾ç‰‡æ˜¾ç¤ºä¸ºå ä½ç¬¦æˆ–æŠ¥é”™

**æ’æŸ¥æ­¥éª¤**:
```bash
# æ£€æŸ¥MinIOæœåŠ¡
docker-compose ps minio

# æ£€æŸ¥å›¾ç‰‡URLå¯è®¿é—®æ€§
curl -I "http://192.168.8.195:8000/api/media/proxy/path/to/image.jpg"

# æ£€æŸ¥Wagtailå›¾ç‰‡è®°å½•
python manage.py shell
>>> from wagtail.images.models import Image
>>> Image.objects.filter(id=HERO_IMAGE_ID).first()
```

**è§£å†³æ–¹æ¡ˆ**:
- é‡å¯MinIOæœåŠ¡: `docker-compose restart minio`
- é‡æ–°ä¸Šä¼ å›¾ç‰‡åˆ°ç®¡ç†åå°
- æ£€æŸ¥å›¾ç‰‡è·¯å¾„å’Œæƒé™

#### 3. è‡ªåŠ¨æ’­æ”¾å¼‚å¸¸
**ç°è±¡**: è½®æ’­å¡ä½ä¸åŠ¨æˆ–è·³è½¬å¼‚å¸¸

**è°ƒè¯•ä»£ç **:
```typescript
// å¼€å¯è°ƒè¯•æ¨¡å¼
const DEBUG = process.env.NODE_ENV === 'development';

useEffect(() => {
  if (DEBUG) {
    console.log('ğŸ¬ Hero Debug:', {
      currentIndex,
      totalItems,
      isPlaying,
      isPaused,
      autoPlayInterval
    });
  }
}, [currentIndex, isPlaying, isPaused]);
```

**è§£å†³æ–¹æ¡ˆ**:
- æ£€æŸ¥ `totalItems > 1`
- éªŒè¯ `autoPlayInterval` æ˜¯å¦ä¸ºæœ‰æ•ˆæ•°å€¼
- ç¡®ä¿æ²¡æœ‰JavaScripté”™è¯¯ä¸­æ–­å®šæ—¶å™¨

### åº”æ€¥é¢„æ¡ˆ

#### Heroå†…å®¹ç´§æ€¥ä¸‹çº¿
```python
# æ‰¹é‡å–æ¶ˆHeroæ ‡è¯†
python manage.py shell
>>> from apps.news.models import ArticlePage  
>>> ArticlePage.objects.filter(is_hero=True).update(is_hero=False)
>>> print("å·²ç´§æ€¥ä¸‹çº¿æ‰€æœ‰Heroå†…å®¹")
```

#### æ¢å¤é»˜è®¤å†…å®¹
```bash
# é‡æ–°å¯¼å…¥å®‰å…¨çš„æµ‹è¯•å†…å®¹
python manage.py import_hero_data --replace
```

## ğŸ”® æœªæ¥å‘å±•

### åŠŸèƒ½å¢å¼º
- [ ] **è§†é¢‘Hero**: æ”¯æŒè§†é¢‘èƒŒæ™¯çš„Heroè½®æ’­
- [ ] **å®æ—¶ç›´æ’­**: é›†æˆç›´æ’­æµçš„Heroå±•ç¤º
- [ ] **æ•°æ®å¤§å±**: æ”¯æŒå›¾è¡¨æ•°æ®çš„å¯è§†åŒ–Hero
- [ ] **äº’åŠ¨æŠ•ç¥¨**: HeroåŒºåŸŸçš„å®æ—¶äº’åŠ¨åŠŸèƒ½

### æŠ€æœ¯å‡çº§
- [ ] **WebP/AVIF**: ä¸‹ä¸€ä»£å›¾ç‰‡æ ¼å¼æ”¯æŒ
- [ ] **é¢„åŠ è½½ä¼˜åŒ–**: æ™ºèƒ½é¢„æµ‹ç”¨æˆ·è¡Œä¸º
- [ ] **æ— éšœç¢å¢å¼º**: æ›´å®Œå–„çš„å±å¹•é˜…è¯»å™¨æ”¯æŒ
- [ ] **PWAé›†æˆ**: ç¦»çº¿ç¼“å­˜Heroå†…å®¹

### è¿è¥å·¥å…·
- [ ] **A/Bæµ‹è¯•**: Heroæ ·å¼å’Œå¸ƒå±€çš„åˆ†ç»„æµ‹è¯•
- [ ] **çƒ­åŠ›å›¾åˆ†æ**: ç”¨æˆ·åœ¨HeroåŒºåŸŸçš„è¡Œä¸ºåˆ†æ
- [ ] **è‡ªåŠ¨è°ƒä¼˜**: åŸºäºæ•°æ®çš„æœ€ä½³å®è·µæ¨è
- [ ] **å†…å®¹æ¨è**: AIè¾…åŠ©çš„Heroå†…å®¹é€‰æ‹©

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [å¤´æ¡æ–°é—»æ¿å—](./å¤´æ¡æ–°é—»æ¿å—.md) - TopStoriesç»„ä»¶æŠ€æœ¯æ–‡æ¡£
- [å…šæŠ¥å¤´æ¡æ•´ä½“è§„åˆ’](./æ–¹å‘æ„æ€.md) - ç³»ç»Ÿæ•´ä½“è®¾è®¡æ€è·¯
- [æŠ€æœ¯æ¶æ„è¯„ä¼°](./0922è¯„ä¼°.md) - å½“å‰ç³»ç»ŸæŠ€æœ¯èƒ½åŠ›åˆ†æ
- [Heroè®¾è®¡è§„èŒƒ](../article/hero.md) - Heroç»„ä»¶çš„è®¾è®¡åŸåˆ™å’Œè§„èŒƒ
- [å¸ƒå±€è®¾è®¡æŒ‡å—](../TODO/Layout/001.md) - é¡µé¢å¸ƒå±€çš„ç»Ÿä¸€è§„èŒƒ

---

**æœ€åæ›´æ–°**: 2025å¹´9æœˆ22æ—¥  
**ç»´æŠ¤å›¢é˜Ÿ**: å‰ç«¯å¼€å‘ç»„ & å†…å®¹è¿è¥å›¢é˜Ÿ  
**è”ç³»æ–¹å¼**: æŠ€æœ¯ç¾¤æˆ–æäº¤Issueåˆ°é¡¹ç›®ä»“åº“

## ğŸ“‹ å¿«é€Ÿæ£€æŸ¥æ¸…å•

### å¼€å‘è€…æ£€æŸ¥æ¸…å•
- [ ] Heroç»„ä»¶æ­£å¸¸æ¸²æŸ“å’Œäº¤äº’
- [ ] ä¸‰ç§é«˜åº¦æ¨¡å¼å·¥ä½œæ­£å¸¸  
- [ ] å›¾ç‰‡åŠ è½½å’Œä¼˜åŒ–ç”Ÿæ•ˆ
- [ ] è§¦æ‘¸æ»‘åŠ¨å’Œé”®ç›˜å¯¼èˆªå¯ç”¨
- [ ] æ€§èƒ½æŒ‡æ ‡æ»¡è¶³è¦æ±‚
- [ ] é”™è¯¯å¤„ç†å’Œé™çº§æœºåˆ¶æ­£å¸¸

### ç¼–è¾‘è€…æ£€æŸ¥æ¸…å•
- [ ] è‡³å°‘è®¾ç½®äº†1-5æ¡Heroå†…å®¹
- [ ] æ¯æ¡Heroå†…å®¹éƒ½æœ‰é«˜è´¨é‡å°é¢å›¾
- [ ] æƒé‡è®¾ç½®åˆç†ï¼Œé‡è¦å†…å®¹ä¼˜å…ˆ  
- [ ] æ ‡é¢˜å’Œæ‘˜è¦ç®€æ´æœ‰åŠ›
- [ ] å‘å¸ƒçŠ¶æ€æ­£ç¡®ï¼Œå†…å®¹å·²ç”Ÿæ•ˆ

### è¿ç»´æ£€æŸ¥æ¸…å•
- [ ] MinIOæœåŠ¡è¿è¡Œæ­£å¸¸
- [ ] ç¼“å­˜å‘½ä¸­ç‡è¾¾æ ‡ (>80%)
- [ ] APIå“åº”æ—¶é—´è¾¾æ ‡ (<500ms)
- [ ] é”™è¯¯ç‡æ§åˆ¶åœ¨åˆç†èŒƒå›´ (<1%)
- [ ] ç›‘æ§å‘Šè­¦é…ç½®æ­£ç¡®
