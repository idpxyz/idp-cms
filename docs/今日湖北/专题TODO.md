# 党报头条 - 专题系统 TODO 清单

> **基于 Wagtail 7.1 架构的专题功能增强计划**  
> 专题系统定位：重大事件深度跟踪的内容聚合功能模块

---

## 🎯 **第一阶段：基础功能完善** (1-2周)

### 📊 **后端模型优化**

- [ ] **Topic模型字段扩展**
  - [ ] 添加 `importance_level` 字段（国家级、重大级、区域级）
  - [ ] 添加 `status` 字段（即将开始、进行中、已结束、已归档）
  - [ ] 添加 `is_breaking` 字段（突发重大事件标识）
  - [ ] 添加 `priority_weight` 字段（优先级权重）
  - [ ] 创建数据迁移文件

- [ ] **Wagtail Admin界面优化**
  - [ ] 更新 `panels` 配置，新增字段分组显示
  - [ ] 添加字段帮助文本和验证规则
  - [ ] 优化专题编辑器用户体验
  - [ ] 添加专题预览功能

- [ ] **数据库优化**
  - [ ] 为新字段创建必要的数据库索引
  - [ ] 优化查询性能（按标签、状态、优先级）
  - [ ] 添加数据完整性约束

### 🔍 **现有问题修复**

- [ ] **ArticlePage.topic_slug 属性修复**
  ```python
  @property
  def topic_slug(self):
      """向后兼容：获取第一个专题的slug"""
      return self.topics.first().slug if self.topics.exists() else ''
  ```

- [ ] **API端点清理**
  - [ ] 审查现有的 `/api/topics/` 端点
  - [ ] 解决与 Headlines、Hot News 的功能重复
  - [ ] 统一API响应格式

## 🚀 **第二阶段：核心功能增强** (2-3周)

### 🎨 **前端展示组件**

- [ ] **Topic模板系统** (参考Channel模板设计)
  - [ ] 添加 `TopicTemplate` 模型 (类似 `ChannelTemplate`)
  - [ ] 修改 `Topic` 模型，添加 `template` 外键字段
  - [ ] 在Wagtail Admin中添加模板选择面板

- [ ] **专题模板文件** (`sites/app/portal/templates/topics/`)
  - [ ] `DefaultTopicTemplate.tsx` - 默认专题模板
  - [ ] `BreakingTopicTemplate.tsx` - 突发重大事件专题模板
  - [ ] `NationalTopicTemplate.tsx` - 国家级专题模板  
  - [ ] `TimelineTopicTemplate.tsx` - 时间线型专题模板
  - [ ] `index.ts` - 专题模板管理器

- [ ] **专题页面渲染器** (`TopicPageRenderer.tsx`)
  - [ ] 实现 `getTopicTemplate()` 函数，动态选择模板
  - [ ] 支持数据库配置优先，slug映射兜底
  - [ ] 统一的模板组件接口

- [ ] **TopicStrip 专题内容条带组件** (`TopicStrip.tsx`)
  - [ ] **参考ChannelStrip设计模式**，针对专题特点调整
  - [ ] 专题头部：标题 + 状态标识 + 重要程度 + 查看更多
  - [ ] 标签横向滚动筛选（替代分类筛选）
  - [ ] 响应式文章网格（复用ChannelStrip的布局逻辑）
  - [ ] 突发专题的特殊样式和动画效果
  - [ ] 加载/错误/无数据状态（复用现有逻辑）

- [ ] **专题详情页面重构** (`/topic/[slug]`)
  - [ ] 使用TopicPageRenderer替代现有简陋实现
  - [ ] 根据专题类型动态选择模板（默认、突发、国家级等）
  - [ ] 集成TopicStrip组件展示专题文章
  - [ ] 复用PageContainer + Section布局结构

### 📡 **API功能扩展**

- [ ] **基于Wagtail API v2**
  - [ ] 扩展 Snippet API 支持专题查询
  - [ ] 自定义序列化器包含文章统计
  - [ ] 添加筛选和排序参数
  - [ ] 支持相关文章的预加载

- [ ] **Next.js API Routes**
  - [ ] `/api/topics` - 专题列表API代理
  - [ ] `/api/topics/[slug]` - 专题详情API代理
  - [ ] `/api/topics/featured` - 推荐专题API
  - [ ] `/api/topics/breaking` - 突发专题API

### 🔄 **内容聚合逻辑**

- [ ] **专题文章排序算法**
  - [ ] 基于文章的 `topic_importance` 字段
  - [ ] 考虑 `is_breaking_news` 优先级
  - [ ] 结合发布时间的综合排序
  - [ ] 缓存优化策略

## 🌟 **第三阶段：高级功能** (3-4周)

### ⏰ **专题生命周期管理**

- [ ] **自动状态更新**
  - [ ] 基于 `start_date` 和 `end_date` 的状态自动切换
  - [ ] Celery定时任务实现状态检查
  - [ ] 状态变更通知机制

- [ ] **专题归档机制**
  - [ ] 自动归档过期专题
  - [ ] 归档专题的搜索优化
  - [ ] 历史专题的查询接口

### 📊 **数据统计和分析**

- [ ] **专题统计功能**
  - [ ] 文章数量统计
  - [ ] 访问量统计（如果有相关数据）
  - [ ] 专题活跃度分析
  - [ ] 统计数据缓存

- [ ] **管理端报表**
  - [ ] 专题创建和使用情况报表
  - [ ] 热门标签和专题标签分布统计
  - [ ] 专题效果分析仪表板

### 🎭 **主题化展示**

- [ ] **专题标签主题**
  - [ ] 基于标签的视觉主题（如"突发"标签显示红色，"庆典"标签显示金色）
  - [ ] CSS类的动态应用
  - [ ] 响应式主题适配

- [ ] **突发事件特殊样式**
  - [ ] 突发专题的醒目标识
  - [ ] 动态效果（闪烁、渐变等）
  - [ ] 紧急通知样式

## 🔧 **第四阶段：性能和用户体验** (2-3周)

### ⚡ **性能优化**

- [ ] **查询优化**
  - [ ] 专题列表查询的 `select_related` 和 `prefetch_related`
  - [ ] 文章统计的缓存机制
  - [ ] 数据库查询分析和优化

- [ ] **缓存策略**
  - [ ] 专题列表的Redis缓存
  - [ ] 专题详情页面的缓存
  - [ ] 缓存失效策略

### 🎨 **用户体验优化**

- [ ] **Wagtail Admin UX**
  - [ ] 专题选择的搜索和筛选功能
  - [ ] 批量专题操作功能
  - [ ] 专题使用情况的可视化展示

- [ ] **前端交互优化**
  - [ ] 专题筛选的即时反馈
  - [ ] 加载状态的优雅处理
  - [ ] 错误处理和用户提示

### 📱 **移动端适配**

- [ ] **响应式设计**
  - [ ] 专题卡片的移动端布局
  - [ ] 触摸友好的交互设计
  - [ ] 移动端性能优化

## 🧪 **第五阶段：测试和文档** (1-2周)

### 🔍 **测试覆盖**

- [ ] **单元测试**
  - [ ] Topic模型的业务逻辑测试
  - [ ] API端点的功能测试
  - [ ] 工具函数的测试覆盖

- [ ] **集成测试**
  - [ ] 专题与文章的关联测试
  - [ ] Wagtail Admin的集成测试
  - [ ] 前端组件的端到端测试

### 📚 **文档更新**

- [ ] **技术文档**
  - [ ] 模型设计文档更新
  - [ ] API文档更新
  - [ ] 部署指南更新

- [ ] **用户手册**
  - [ ] 编辑人员使用指南
  - [ ] 专题管理最佳实践
  - [ ] 故障排除指南

## 🎛️ **运维和监控** (持续进行)

### 📈 **监控指标**

- [ ] **业务指标监控**
  - [ ] 专题创建和使用频率
  - [ ] 不同标签专题的表现
  - [ ] 用户行为分析

- [ ] **技术指标监控**
  - [ ] API响应时间监控
  - [ ] 数据库查询性能监控
  - [ ] 缓存命中率监控

### 🛠️ **维护任务**

- [ ] **定期维护**
  - [ ] 专题数据的清理和归档
  - [ ] 性能指标的定期评估
  - [ ] 用户反馈的收集和处理

---

## 📋 **实施优先级说明**

### 🔴 **高优先级** (第一、二阶段)
专题系统的基础功能完善，确保与现有架构的兼容性和基本可用性。

### 🟡 **中优先级** (第三、四阶段)  
增强功能和性能优化，提升用户体验和系统效率。

### 🟢 **低优先级** (第五阶段及持续)
测试、文档和长期维护，确保系统的可维护性和可扩展性。

---

## 🎯 **成功标准**

- [ ] ✅ **功能完整性**: 专题系统能够有效支持重大事件的深度跟踪
- [ ] ✅ **架构兼容性**: 与现有Wagtail系统无缝集成，不破坏现有功能
- [ ] ✅ **性能表现**: 专题相关页面的加载时间在2秒以内
- [ ] ✅ **用户满意度**: 编辑人员反馈专题管理功能易用且高效
- [ ] ✅ **代码质量**: 测试覆盖率达到80%以上，代码符合项目规范

---

**创建日期**: 2025年9月28日  
**最后更新**: 2025年9月28日  
**负责团队**: 党报头条技术开发组  
**预计完成时间**: 10-12周

> 💡 **注意**: 此TODO列表基于现有Wagtail架构设计，所有功能都将作为CMS的功能模块实现，而非独立系统。在实施过程中应与现有代码库保持高度兼容性。
