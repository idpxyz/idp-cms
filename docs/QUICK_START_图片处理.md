# 快速开始：文章封面图片处理

## 🎯 核心改进

我们已经实施了一个**智能三级回退机制**来处理文章封面图片：

```
1️⃣ 手动上传的封面图片（推荐）
   ↓
2️⃣ 自动从正文提取的第一张图片
   ↓  
3️⃣ 基于分类的本地默认封面图片
```

**结果**：无论文章有没有图片，首页都不会"花掉"（显示混乱）！

---

## 🚀 立即使用

### 作为编辑

在 Wagtail 后台编辑文章时，你会看到封面图片字段上方有一个黄色提示框：

```
💡 封面图片提示
• 建议为文章上传封面图片，提升首页展示效果
• 如果不上传封面，系统会自动尝试从正文中提取第一张图片
• 如果正文也没有图片，系统会根据文章分类显示默认封面图片
• 推荐尺寸：1200x675 (16:9) 或 800x450
```

**你可以选择**：
- ✅ **最佳**：上传专门的封面图片
- ⭐ **次优**：在正文中插入图片（系统会自动提取第一张）
- 👌 **可接受**：什么都不做（系统会显示精美的默认封面）

### 作为开发者/管理员

所有改进都已自动生效，无需手动配置！

**已生成的默认封面**：
```bash
ls sites/public/images/default-covers/
# 输出：
# default.svg  politics.svg  economy.svg  tech.svg
# culture.svg  sports.svg  health.svg  education.svg
# environment.svg  international.svg  society.svg
# military.svg  travel.svg
```

---

## 📊 效果对比

### 之前的问题

| 文章状态 | 显示效果 |
|---------|---------|
| 有封面 | ✅ 正常显示 |
| 无封面，有正文图片 | ❌ 显示空白或占位符 |
| 无封面，无图片 | ❌ 显示空白或依赖外部服务 |

**问题**：首页视觉混乱，部分图片加载失败

### 现在的方案

| 文章状态 | 显示效果 |
|---------|---------|
| 有封面 | ✅ 显示真实封面 |
| 无封面，有正文图片 | ✅ 自动提取为封面 |
| 无封面，无图片 | ✅ 显示精美的默认封面 |

**效果**：首页视觉统一，专业美观，加载迅速

---

## 🎨 默认封面预览

默认封面是彩色渐变背景 + 对应图标 + 分类名称，例如：

- 🏛️ **政治** - 红色背景
- 💼 **经济** - 绿色背景  
- 💻 **科技** - 紫色背景
- ⚽ **体育** - 橙色背景
- 📰 **默认** - 蓝色背景

每个分类都有独特的颜色和图标，让读者一眼就能识别新闻类型。

---

## ⚙️ 可选配置

### 重新生成默认封面

如果想修改默认封面的颜色或图标：

```bash
cd /opt/idp-cms
# 编辑配置
nano scripts/generate_default_covers.py

# 重新生成
python3 scripts/generate_default_covers.py
```

### 为现有文章补充封面

进入 Django shell：

```bash
cd /opt/idp-cms
python manage.py shell
```

运行脚本：

```python
from apps.news.models import ArticlePage

# 为所有没有封面的文章从正文提取图片
count = 0
for article in ArticlePage.objects.filter(cover__isnull=True):
    if article.auto_set_cover_from_body():
        article.save(auto_cover_from_body=False)
        count += 1
        print(f"✓ 已为文章 {article.id}: {article.title} 设置封面")

print(f"\n总共为 {count} 篇文章设置了封面")
```

---

## 💡 最佳实践

### 推荐做法

1. **重要文章**：上传高质量专用封面（1200x675）
2. **一般文章**：在正文开头插入图片（会自动成为封面）
3. **快速发布**：直接发布，让系统使用默认封面

### 图片规格建议

- **封面图片**：1200x675 (16:9) 或 800x450
- **正文图片**：宽度不超过 1200px
- **格式**：JPEG、PNG、WebP
- **文件大小**：< 500KB（系统会自动优化）

---

## ❓ 常见问题

**Q: 首页还会显示外部 Picsum 图片吗？**  
A: 不会了。现在使用本地 SVG 默认封面，速度更快更可靠。

**Q: 开发环境看到图片右上角有"默认"标识？**  
A: 这是开发提示，生产环境不会显示。

**Q: 能看到文章用的是哪张默认封面吗？**  
A: 默认封面根据文章的频道和标签智能匹配，例如"科技"频道会显示紫色背景的 💻 图标。

**Q: 自动提取正文图片会影响性能吗？**  
A: 不会。只在保存文章时执行一次，且有异常处理保护。

---

## 🎉 总结

这套方案确保了：
- ✅ **首页不会"花掉"** - 所有文章都有合适的封面图片
- ✅ **视觉效果统一** - 即使没有图片也能显示精美的默认封面
- ✅ **编辑更灵活** - 可以手动上传，也可以让系统自动处理
- ✅ **性能更优** - 本地图片，无需外部服务依赖

**现在就去发布文章，享受新的图片处理体验吧！** 🚀


