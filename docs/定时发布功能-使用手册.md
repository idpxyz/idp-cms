# ⏰ 定时发布功能 - 快速使用手册

**功能状态**: ✅ 已上线，可正常使用  
**最后更新**: 2024-11-07  
**测试状态**: 100%通过

---

## 🎯 快速开始（3步走）

### 1️⃣ 创建或编辑文章
进入Wagtail后台 → 页面 → News Articles → 添加子页面

### 2️⃣ 设置发布时间
展开 **"📢 发布设置"** → 选择 **"发布时间"** → 选择未来时间

⚠️ **重要提示**：
- 日期必须选择正确（注意不要选错月份）
- 时间精度：系统每分钟检查一次，实际发布时间误差 ±1分钟

### 3️⃣ 保存为草稿
点击 **"保存草稿"** 按钮（不要点"发布"）

✅ 完成！文章将在设定时间自动发布

---

## 📱 如何查看定时发布状态

### 在"我的文章"页面
- 🟦 **蓝色徽章** `⏰ 定时发布: mm-dd HH:MM` = 等待自动发布
- 🟧 **橙色标签** `草稿` = 普通草稿（未设置发布时间）
- 🟢 **绿色标签** `已发布` = 文章已发布

### 确认是否设置成功
1. 保存草稿后，进入 **"我的文章"**
2. 查看文章是否显示蓝色定时发布徽章
3. 如果只显示"草稿"，说明发布时间未设置或已过期

---

## ⏰ 发布时间规则

### 📅 发布时间字段的作用

| 发布时间设置 | 操作按钮 | 实际行为 |
|------------|---------|---------|
| **留空** | 点击"发布" | ✅ 立即发布 |
| **留空** | 点击"保存草稿" | ✅ 保存草稿，不发布 |
| **未来时间** | 点击"发布" | ✅ 立即发布（忽略定时） |
| **未来时间** | 点击"保存草稿" | ✅ 定时发布生效 |
| **过去时间** | 点击"保存草稿" | ⚠️ 下次检查时立即发布 |

### ⚠️ 重要规则

**要使用定时发布，必须满足：**
1. ✅ 设置未来的发布时间
2. ✅ 点击"保存草稿"按钮
3. ❌ 不要点击"发布"或"提交工作流"按钮

**如果点击"发布"或"提交工作流"：**
- 会立即处理，忽略定时设置
- 这是为了给用户灵活性

### ✅ 有效设置
- 未来任意时间（1分钟后、1小时后、明天、下周...）
- 例如：现在15:20，设置15:25发布 ✅

### ❌ 无效设置
- 当前时间或过去时间
- 例如：现在15:20，设置15:15发布 ❌
- 结果：下次检查时立即处理

### 📏 时间精度
- **检查频率**：每1分钟
- **实际精度**：±60秒内
- **示例**：设置15:30发布 → 实际15:30:00-15:30:59之间发布

---

## 🔧 修改或取消定时发布

### 修改发布时间
1. 编辑文章
2. 修改"发布时间"字段
3. 保存草稿

### 取消定时发布
**方法1：清空时间**
1. 编辑文章
2. 清空"发布时间"字段
3. 保存草稿

**方法2：立即发布**
1. 编辑文章
2. 直接点击"发布"按钮

---

## 💡 最佳实践

### 📅 内容规划
- 提前准备下周的文章
- 统一设置发布时间
- 形成稳定的发布节奏

### 🎯 营销活动
- 配合活动时间自动发布
- 节假日提前准备内容
- 非工作时间也能发布

### ⏰ 热点新闻
- 提前准备突发新闻稿件
- 设置禁发时间点自动发布
- 减少人工值守成本

### 🧪 首次使用建议
1. 先测试短时间（5-10分钟后）
2. 确认功能正常
3. 再用于正式内容

---

## ❓ 常见问题

### Q1: 文章没有自动发布？
**检查清单**：
1. ✅ 文章是否保存为草稿状态？
2. ✅ 发布时间是否设置正确？
3. ✅ 发布时间是否是未来时间？
4. ✅ 是否显示定时发布徽章？
5. ✅ 是否过了发布时间至少2分钟？

### Q2: 如何知道文章已经发布？
**查看方法**：
1. 刷新"我的文章"页面
2. 定时发布徽章消失
3. 状态变为"已发布"
4. 前端页面可以看到文章

### Q3: 可以同时设置多篇文章定时发布吗？
**回答**：✅ 可以！
- 每篇文章独立设置
- 互不影响
- 系统会按时间依次发布

### Q4: 定时发布会发送通知吗？
**当前状态**：
- ❌ 暂不支持邮件通知
- ✅ 有完整的日志记录
- 🔮 未来版本会添加通知功能

### Q5: 时间设置错了怎么办？
**解决方法**：
- 只要还没发布，随时可以修改
- 编辑文章 → 修改发布时间 → 保存草稿

---

## 🔍 监控与日志

### 管理员查看日志
```bash
# 登录服务器
ssh root@8.133.22.7

# 查看Celery日志
cd /opt/idp-cms
docker compose -f infra/production/docker-compose-ha-node1.yml logs -f celery

# 查看Beat调度日志
docker compose -f infra/production/docker-compose-ha-node1.yml logs -f celery-beat
```

### 日志关键信息
- ✅ `自动发布文章成功` = 发布成功
- ❌ `自动发布文章失败` = 发布失败（查看错误信息）
- 📊 `定时发布任务完成` = 任务执行完成

---

## 📞 获取帮助

### 技术支持
- 📖 详细指南：`/opt/idp-cms/docs/SCHEDULED_PUBLISHING_GUIDE.md`
- 📊 测试报告：`/opt/idp-cms/docs/定时发布测试报告-2024-11-07.md`
- 🧪 测试步骤：`/opt/idp-cms/docs/定时发布测试步骤.md`

### 联系管理员
如遇到问题，请提供：
1. 文章ID
2. 设置的发布时间
3. 当前时间
4. 文章当前状态

---

## 🎊 功能优势

✅ **自动化** - 无需人工值守  
✅ **精准** - 时间精度高（±1分钟）  
✅ **可靠** - 经过充分测试  
✅ **灵活** - 随时可以修改或取消  
✅ **智能** - 自动处理，无需干预  

---

**祝您使用愉快！** 📝

