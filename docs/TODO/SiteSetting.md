è®©æˆ‘å…ˆæŸ¥çœ‹ä¸€ä¸‹å½“å‰çš„`SiteSettings`æ¨¡å‹ï¼Œç„¶ååˆ¶å®šä¸€ä¸ªå®Œæ•´çš„é‡æ„ä»»åŠ¡åˆ†è§£ï¼š

Read file: apps/core/models.py
å¾ˆå¥½ï¼æˆ‘çœ‹åˆ°æ‚¨å·²ç»æœ‰äº†ä¸€ä¸ªå¾ˆå¥½çš„`SiteSettings`æ¨¡å‹ã€‚ç°åœ¨è®©æˆ‘åˆ¶å®šä¸€ä¸ªå®Œæ•´çš„é‡æ„ä»»åŠ¡åˆ†è§£ï¼š

## ï¿½ï¿½ **é‡æ„ä»»åŠ¡åˆ†è§£ - ä» YAML é…ç½®åˆ° Wagtail å†…ç½®ç®¡ç†**

### **ç¬¬ä¸€é˜¶æ®µï¼šåˆ†æå’Œå‡†å¤‡ï¼ˆ1-2 å¤©ï¼‰**

#### **1.1 ç°çŠ¶åˆ†æ** âœ…

- [x] åˆ†æç°æœ‰ YAML é…ç½®æ–‡ä»¶çš„ä½¿ç”¨æƒ…å†µ
- [x] æ£€æŸ¥ Wagtail ç«™ç‚¹ç®¡ç†çŠ¶æ€
- [x] è¯„ä¼°`SiteSettings`æ¨¡å‹çš„å®Œæ•´æ€§

#### **1.2 ä¾èµ–å…³ç³»æ¢³ç†**

- [ ] è¯†åˆ«æ‰€æœ‰ç¡¬ç¼–ç çš„ç«™ç‚¹åç§°å¼•ç”¨
- [ ] åˆ†æé…ç½®ç®¡ç†ç³»ç»Ÿçš„ä¾èµ–å…³ç³»
- [ ] åˆ¶å®šè¿ç§»ç­–ç•¥å’Œå›æ»šæ–¹æ¡ˆ

### **ç¬¬äºŒé˜¶æ®µï¼šæ¨¡å‹å®Œå–„ï¼ˆ2-3 å¤©ï¼‰**

#### **2.1 æ‰©å±• SiteSettings æ¨¡å‹**

- [ ] æ·»åŠ ç¼ºå¤±çš„é…ç½®å­—æ®µï¼ˆåŠŸèƒ½å¼€å…³ã€UI ä¸»é¢˜ç­‰ï¼‰
- [ ] åˆ›å»ºé…ç½®éªŒè¯æ–¹æ³•
- [ ] æ·»åŠ é…ç½®ç»§æ‰¿å’Œé»˜è®¤å€¼æœºåˆ¶

#### **2.2 åˆ›å»ºé…ç½®ç®¡ç†æ¥å£**

- [ ] å®ç°é…ç½®çš„ CRUD æ“ä½œ
- [ ] æ·»åŠ é…ç½®ç¼“å­˜æœºåˆ¶
- [ ] åˆ›å»ºé…ç½®éªŒè¯è§„åˆ™

### **ç¬¬ä¸‰é˜¶æ®µï¼šé…ç½®ç³»ç»Ÿé‡æ„ï¼ˆ3-4 å¤©ï¼‰**

#### **3.1 é‡æ„é…ç½®åŠ è½½å™¨**

- [ ] ä¿®æ”¹`site_config.py`ä½¿ç”¨æ•°æ®åº“è€Œéæ–‡ä»¶
- [ ] å®ç°é…ç½®çš„åŠ¨æ€æ›´æ–°
- [ ] ä¿æŒå‘åå…¼å®¹æ€§

#### **3.2 æ›´æ–°é…ç½®å·¥å…·**

- [ ] é‡æ„`site_utils.py`ä½¿ç”¨æ–°çš„é…ç½®æº
- [ ] æ›´æ–°ç«™ç‚¹æ˜ å°„é€»è¾‘
- [ ] ä¼˜åŒ–é…ç½®æŸ¥è¯¢æ€§èƒ½

### **ç¬¬å››é˜¶æ®µï¼šç®¡ç†ç•Œé¢ä¼˜åŒ–ï¼ˆ2-3 å¤©ï¼‰**

#### **4.1 Wagtail Snippets é›†æˆ**

- [ ] å°†`SiteSettings`æ³¨å†Œä¸º Wagtail Snippet
- [ ] è‡ªå®šä¹‰ç®¡ç†ç•Œé¢
- [ ] æ·»åŠ é…ç½®ç¼–è¾‘è¡¨å•

#### **4.2 ç«™ç‚¹ç®¡ç†ä¼˜åŒ–**

- [ ] ä¼˜åŒ– Wagtail å†…ç½®çš„ç«™ç‚¹ç®¡ç†ç•Œé¢
- [ ] æ·»åŠ é…ç½®å¿«é€Ÿè®¿é—®é“¾æ¥
- [ ] å®ç°é…ç½®é¢„è§ˆåŠŸèƒ½

### **ç¬¬äº”é˜¶æ®µï¼šæ¸…ç†å’Œæµ‹è¯•ï¼ˆ2-3 å¤©ï¼‰**

#### **5.1 æ¸…ç†æ—§é…ç½®**

- [ ] åˆ é™¤ä¸å¿…è¦çš„ YAML é…ç½®æ–‡ä»¶
- [ ] æ¸…ç†ç¡¬ç¼–ç çš„ç«™ç‚¹å¼•ç”¨
- [ ] æ›´æ–°ç›¸å…³æ–‡æ¡£

#### **5.2 åŠŸèƒ½æµ‹è¯•**

- [ ] æµ‹è¯•é…ç½®åŠ è½½å’Œæ›´æ–°
- [ ] éªŒè¯å¤šç«™ç‚¹åŠŸèƒ½
- [ ] æ€§èƒ½æµ‹è¯•å’Œä¼˜åŒ–

## ï¿½ï¿½ **è¯¦ç»†ä»»åŠ¡æ¸…å•**

### **ä»»åŠ¡ 1ï¼šå®Œå–„ SiteSettings æ¨¡å‹**

```python
# éœ€è¦æ·»åŠ çš„å­—æ®µ
class SiteSettings(models.Model):
    # åŠŸèƒ½å¼€å…³
    ai_recommendation = models.BooleanField(default=True)
    search_enabled = models.BooleanField(default=True)
    comments_enabled = models.BooleanField(default=False)

    # UIä¸»é¢˜
    theme = models.CharField(max_length=50, default="default")
    primary_color = models.CharField(max_length=7, default="#3B82F6")
    secondary_color = models.CharField(max_length=7, default="#6B7280")

    # å†…å®¹ç­–ç•¥
    content_moderation = models.BooleanField(default=False)
    auto_publish = models.BooleanField(default=False)
    allow_aggregate = models.BooleanField(default=True)
```

### **ä»»åŠ¡ 2ï¼šåˆ›å»ºé…ç½®ç®¡ç†å‘½ä»¤**

```bash
# æ–°çš„ç®¡ç†å‘½ä»¤
python manage.py site_settings create --site=beijing.aivoya.com
python manage.py site_settings update --site=beijing.aivoya.com --key=theme --value=tech
python manage.py site_settings migrate --from-yaml
```

### **ä»»åŠ¡ 3ï¼šé‡æ„é…ç½®åŠ è½½å™¨**

```python
# ä¿®æ”¹apps/core/site_config.py
class ConfigLoader:
    def load_from_database(self, site_id: str) -> Optional[Dict[str, Any]]:
        """ä»æ•°æ®åº“åŠ è½½é…ç½®"""
        try:
            site = Site.objects.get(hostname=site_id)
            settings = SiteSettings.get_for_site(site)
            return self._serialize_settings(settings)
        except Site.DoesNotExist:
            return None
```

### **ä»»åŠ¡ 4ï¼šæ›´æ–°ç®¡ç†ç•Œé¢**

```python
# åœ¨apps/core/wagtail_hooks.pyä¸­
@hooks.register('construct_settings_panels')
def construct_site_settings_panels(panels, instance):
    """è‡ªå®šä¹‰ç«™ç‚¹è®¾ç½®é¢æ¿"""
    panels.extend([
        FieldPanel('ai_recommendation'),
        FieldPanel('search_enabled'),
        FieldPanel('theme'),
        FieldPanel('primary_color'),
    ])
```

## ï¿½ï¿½ **æ‰§è¡Œä¼˜å…ˆçº§**

### **é«˜ä¼˜å…ˆçº§** ï¿½ï¿½

1. å®Œå–„`SiteSettings`æ¨¡å‹
2. é‡æ„é…ç½®åŠ è½½å™¨
3. åˆ›å»ºè¿ç§»è„šæœ¬

### **ä¸­ä¼˜å…ˆçº§** ğŸŸ¡

1. ä¼˜åŒ–ç®¡ç†ç•Œé¢
2. æ¸…ç†æ—§é…ç½®æ–‡ä»¶
3. æ›´æ–°æ–‡æ¡£

### **ä½ä¼˜å…ˆçº§** ï¿½ï¿½

1. æ€§èƒ½ä¼˜åŒ–
2. é«˜çº§åŠŸèƒ½
3. ç›‘æ§å’Œå‘Šè­¦

## â±ï¸ **æ—¶é—´ä¼°ç®—**

- **æ€»å·¥æœŸ**: 10-15 å¤©
- **å…³é”®è·¯å¾„**: æ¨¡å‹å®Œå–„ â†’ é…ç½®é‡æ„ â†’ ç•Œé¢ä¼˜åŒ–
- **é£é™©ç‚¹**: é…ç½®è¿ç§»ã€å‘åå…¼å®¹æ€§

## ï¿½ï¿½ **é£é™©æ§åˆ¶**

1. **æ¸è¿›å¼è¿ç§»**: å…ˆæ”¯æŒæ–°ç³»ç»Ÿï¼Œå†é€æ­¥æ›¿æ¢æ—§ç³»ç»Ÿ
2. **å›æ»šæ–¹æ¡ˆ**: ä¿ç•™æ—§é…ç½®æ–‡ä»¶ä½œä¸ºå¤‡ä»½
3. **æµ‹è¯•è¦†ç›–**: æ¯ä¸ªé˜¶æ®µéƒ½è¦æœ‰å®Œæ•´çš„æµ‹è¯•
4. **æ–‡æ¡£æ›´æ–°**: åŠæ—¶æ›´æ–°ç›¸å…³æ–‡æ¡£å’ŒæŒ‡å—

æ‚¨è§‰å¾—è¿™ä¸ªä»»åŠ¡åˆ†è§£åˆç†å—ï¼Ÿæˆ‘ä»¬å¯ä»¥ä»å“ªä¸ªé˜¶æ®µå¼€å§‹ï¼ŸğŸš€
