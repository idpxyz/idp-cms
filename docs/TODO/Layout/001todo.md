# Portal 布局重构 TODO 清单

基于设计文档 `001.md` 的要求，对 `sites/portal` 进行全面重构升级。

## 📋 项目概述

**目标：** 将当前的 Portal 实现调整为符合新闻综合网站设计规范的专业布局  
**优先级：** 🔴 高优先级 🟡 中优先级 🟢 低优先级  
**状态：** ⏳ 待开始 🔄 进行中 ✅ 已完成 ❌ 已取消

---

## 🚀 阶段一：核心首页布局重构

### 1.1 HERO 轮播系统 🔴
- [x] **创建 HeroCarousel 组件** `sites/app/portal/components/HeroCarousel.tsx`
  - [x] 支持 3-5 条轮播内容
  - [x] 大图/视频封面显示
  - [x] 突发新闻红角标功能
  - [x] 自动播放控制（6s/条）
  - [x] 手动导航控制
  - [x] 响应式高度适配（≥1280px: 60-75vh, 768-1279px: 50-60vh, ≤767px: 45-55vh）
  - [x] 触摸滑动支持（移动端）
  - [x] 预加载优化（fetchpriority=high）
- [x] **创建数据获取工具** `sites/app/portal/components/HeroCarousel.utils.ts`
  - [x] 智能推荐数据获取
  - [x] 传统API回退机制
  - [x] 模拟数据生成器
- [x] **集成到首页** 修改 `sites/app/portal/page.tsx`
  - [x] 添加轮播到页面顶部
  - [x] 并行数据获取优化
  - [x] 全宽度布局实现
- [x] **创建演示页面** `sites/app/portal/demo/hero-carousel/page.tsx`
  - [x] 功能演示和测试
  - [x] 响应式效果展示
  - [x] 使用说明文档

### 1.2 Breaking Ticker 滚动快讯 🔴  
- [ ] **升级 QuickTickerModule** `sites/app/portal/components/QuickTickerModule.tsx`
  - [ ] 真正的水平滚动效果（6s/条）
  - [ ] SSE 实时更新支持
  - [ ] 鼠标悬停暂停功能
  - [ ] 点击跳转快讯页功能
  - [ ] 移动端滚动速度优化
  - [ ] 无障碍访问支持

### 1.3 Top Stories 网格布局 🔴
- [ ] **创建 TopStoriesGrid 组件** `sites/app/portal/components/TopStoriesGrid.tsx`
  - [ ] 2行×3列混排布局（桌面端）
  - [ ] 编辑推荐:算法推荐 = 2:1 比例
  - [ ] 跨频道内容去重逻辑
  - [ ] 卡片要素完整展示：
    - [ ] 16:9 缩略图（支持 4:3 兼容）
    - [ ] 2-3行标题 + 1-2行摘要
    - [ ] 频道徽标显示
    - [ ] 发布时间格式化
    - [ ] 事件/专题 Chip 标签
  - [ ] 响应式适配（桌面3列→平板2列→手机1列）
  - [ ] 骨架屏加载状态

### 1.4 首页布局重组 🔴
- [ ] **重构 page.tsx 主页面结构**
  - [ ] 按设计文档重新排列组件顺序
  - [ ] 三栏布局实现（Desktop）
  - [ ] 右侧栏内容规划：直播/视频/最热榜/市场数据
  - [ ] 移动端单栏适配
  - [ ] 性能优化（组件懒加载）

---

## 🎯 阶段二：导航系统增强

### 2.1 MegaMenu 下拉菜单 🔴
- [ ] **创建 MegaMenu 组件** `sites/app/portal/components/MegaMenu.tsx`
  - [ ] 频道悬停触发下拉
  - [ ] 显示该频道 Top-6 分类 Chips
  - [ ] 右列显示"本频道最热 Top-5"
  - [ ] "全部分类 ▸" 链接
  - [ ] 键盘操作支持（Tab/Enter/Esc）
  - [ ] 点击外部关闭
  - [ ] 动画过渡效果
  - [ ] 移动端适配（可能改为全屏模式）

### 2.2 频道导航优化 🟡
- [ ] **增强 ChannelNavigation.tsx**
  - [ ] 集成 MegaMenu 功能
  - [ ] 导航项 hover 状态优化
  - [ ] 当前频道高亮显示
  - [ ] 响应式折叠优化
  - [ ] 个性化排序动画

### 2.3 分类导航增强 🟡
- [ ] **升级 CategoryNavigation.tsx**
  - [ ] 粘性定位优化（top: calc(var(--sticky-offset) + 60px)）
  - [ ] 底边条滑动动画（200ms transition）
  - [ ] "更多▾" 面板搜索框
  - [ ] 两列清单布局
  - [ ] 键盘上下/回车选择支持
  - [ ] 当前分类 8% 浅色背景

---

## 📰 阶段三：频道条带系统

### 3.1 频道条带组件 🟡
- [ ] **创建 ChannelStrip 组件** `sites/app/portal/components/ChannelStrip.tsx`
  - [ ] 频道标题 + Logo 展示
  - [ ] 分类 Chips 横向滚动
  - [ ] 5-7个文章卡片展示
  - [ ] 点击分类 Chip 局部刷新内容
  - [ ] "更多 ▾" 展开功能
  - [ ] 移动端横向滑动支持

### 3.2 频道条带集成 🟡
- [ ] **在首页集成频道条带**
  - [ ] Top Stories 和推荐流之间插入
  - [ ] 每个活跃频道生成一个条带
  - [ ] 条带间距和视觉层次
  - [ ] 懒加载优化
  - [ ] 错误状态处理

---

## 📑 阶段四：分类页面完善

### 4.1 分类页头部增强 🟡
- [ ] **更新 category/[slug]/page.tsx**
  - [ ] 完善面包屑导航（支持多级）
  - [ ] 分类描述和统计信息
  - [ ] 文章量/更新频率标签
  - [ ] 相关频道显示

### 4.2 范围切换功能 🟡
- [ ] **添加范围切换 Chips**
  - [ ] "仅本频道 | 全站聚合" 选项
  - [ ] 默认根据入口来源设置
  - [ ] 切换时数据重新获取
  - [ ] URL 参数同步

### 4.3 筛选条系统 🟡
- [ ] **创建 CategoryFilters 组件** `sites/app/portal/components/CategoryFilters.tsx`
  - [ ] 时间筛选：24h/7d/30d
  - [ ] 类型筛选：深度/快讯/视频/图解
  - [ ] 地域筛选
  - [ ] 筛选状态 URL 同步
  - [ ] 重置功能
  - [ ] 筛选结果计数显示

### 4.4 分类页侧边栏 🟡
- [ ] **完善分类页右侧内容**
  - [ ] 相关专题条带
  - [ ] 热门标签云
  - [ ] 本分类最热文章
  - [ ] 子分类导航（如有）

---

## 📄 阶段五：文章页面回流优化

### 5.1 文章页导航增强 🟡
- [ ] **更新 article/[slug]/page.tsx**
  - [ ] 标题下显示频道 Chip + 分类 Chips（最多3个）
  - [ ] 专题/话题标签
  - [ ] 点击回到来源列表并恢复滚动位置（cursor）

### 5.2 文章内推荐 🟡
- [ ] **段间软推荐功能**
  - [ ] 同分类/同专题文章推荐
  - [ ] 进入视窗才淡入显示
  - [ ] 推荐内容去重

### 5.3 文章页尾部 🟡
- [ ] **文末推荐区域**
  - [ ] "下一篇（同分类）" 功能
  - [ ] "本频道精选" 推荐
  - [ ] "继续看此专题" 链接

---

## 📱 阶段六：响应式和性能优化

### 6.1 断点系统统一 🟡
- [ ] **创建统一断点配置** `sites/styles/breakpoints.css`
  - [ ] ≥1280px: 3列布局，HERO 60-75vh，分类 6-8个一行
  - [ ] 768-1279px: 2列布局，HERO 50-60vh，分类 5-6个可换行
  - [ ] ≤767px: 1列布局，HERO 45-55vh，分类横向滑动 4-5个
  - [ ] 更新所有组件的响应式类名

### 6.2 图片和媒体优化 🟡
- [ ] **媒体资源优化**
  - [ ] 图片比例：16:9 主要，4:3 兼容
  - [ ] 移动端优先竖裁切
  - [ ] 首屏图片 fetchpriority=high
  - [ ] 其他图片 loading=lazy
  - [ ] WebP 格式支持

### 6.3 加载状态优化 🟡
- [ ] **完善骨架屏系统**
  - [ ] 缩略图占位 + 2行文本占位
  - [ ] 错误状态"重试"按钮
  - [ ] 加载动画统一设计
  - [ ] 网络错误处理

---

## ✨ 阶段七：微交互和动画

### 7.1 过渡动画 🟢
- [ ] **Tabs 过渡动画**
  - [ ] 200ms 下划线滑动
  - [ ] 当前 Chip 背景 8% 浅色
  - [ ] 平滑的颜色过渡

### 7.2 卡片交互 🟢
- [ ] **卡片 Hover 效果**
  - [ ] 阴影 + 2px 上浮
  - [ ] 标题下划线显示
  - [ ] 可访问状态 :focus 明显描边

### 7.3 滚动动画 🟢
- [ ] **Ticker 滚动优化**
  - [ ] 6s/条平滑滚动
  - [ ] 鼠标悬停暂停
  - [ ] 无缝循环效果

### 7.4 交互反馈 🟢
- [ ] **用户操作反馈**
  - [ ] "更多面板" Esc 关闭
  - [ ] 键盘操作视觉反馈
  - [ ] 加载状态指示器
  - [ ] 操作成功/失败提示

---

## ♿ 阶段八：可访问性和国际化

### 8.1 可访问性增强 🟢
- [ ] **WCAG 2.1 AA 标准**
  - [ ] 所有图像添加 alt 属性
  - [ ] 导航/Chips 键盘操作支持
  - [ ] 颜色对比度 ≥ 4.5:1
  - [ ] 屏幕阅读器支持
  - [ ] 焦点管理优化

### 8.2 国际化支持 🟢
- [ ] **多语言准备**
  - [ ] name_zh/name_en 双语字段利用
  - [ ] URL slug 稳定性保证
  - [ ] RTL 语言 Chips 顺序自动反向
  - [ ] 日期时间格式国际化

### 8.3 SEO 优化 🟢
- [ ] **搜索引擎优化**
  - [ ] 语义化 HTML 标签
  - [ ] 结构化数据标记
  - [ ] Open Graph 标签完善
  - [ ] 页面加载性能优化

---

## 🔧 技术实现要点

### 数据流管理
- [ ] **Context 状态优化**
  - [ ] 频道状态管理增强
  - [ ] 分类状态管理增强
  - [ ] 全局筛选状态管理
  - [ ] 用户偏好状态持久化

### 性能优化
- [ ] **组件优化**
  - [ ] React.memo 使用优化
  - [ ] useMemo/useCallback 合理使用
  - [ ] 组件懒加载实现
  - [ ] 图片懒加载优化

### 类型安全
- [ ] **TypeScript 增强**
  - [ ] 完善组件 Props 类型定义
  - [ ] API 响应类型定义
  - [ ] 事件处理类型安全
  - [ ] 配置项类型检查

---

## 📊 验收标准

### 功能验收
- [ ] 所有页面在三种断点下正常显示
- [ ] 导航系统响应迅速且准确
- [ ] 内容加载和筛选功能正常
- [ ] 用户交互流畅无卡顿

### 性能验收
- [ ] 首屏加载时间 < 2s
- [ ] Lighthouse 性能评分 > 90
- [ ] 核心 Web Vitals 指标达标
- [ ] 移动端性能优化达标

### 可访问性验收
- [ ] WCAG 2.1 AA 标准符合率 > 95%
- [ ] 键盘导航完全可用
- [ ] 屏幕阅读器兼容性测试通过
- [ ] 颜色对比度检查通过

---

## 📝 开发规范

### 代码规范
- 遵循现有的 TypeScript 和 React 最佳实践
- 组件命名采用 PascalCase，文件名与组件名一致
- 使用统一的 CSS 类名规范（Tailwind CSS）
- 添加适当的注释和文档

### 测试要求
- 关键组件需要单元测试覆盖
- 交互功能需要集成测试
- 响应式布局需要视觉回归测试
- 可访问性需要自动化测试

### 文档要求
- 新组件需要添加 README 说明
- API 变更需要更新文档
- 重要功能需要使用示例
- 部署说明需要及时更新

---

## 🗓️ 时间规划

**第1-2周：** 阶段一（核心首页布局）  
**第3周：** 阶段二（导航系统）  
**第4周：** 阶段三（频道条带）  
**第5周：** 阶段四（分类页面）  
**第6周：** 阶段五（文章页面）  
**第7周：** 阶段六（响应式优化）  
**第8周：** 阶段七八（微交互和可访问性）

**总计：** 8周完整实现，2个月交付周期

---

## 📞 联系和协作

**技术负责人：** [待指定]  
**设计审核：** [待指定]  
**测试负责：** [待指定]  
**项目跟踪：** 本 TODO 文档 + 项目管理工具

---

*最后更新：2025-09-17*  
*版本：v1.0*  
*状态：规划阶段*
