æˆ‘æ¥å¸®ä½ æ£€æŸ¥é¡¹ç›®æ˜¯å¦å®ç°äº†è¿™ä¸ªæ¶æ„æµç¨‹ï¼šWagtailï¼ˆAuthoringï¼‰ â†’ Celery Indexer â†’ OpenSearchï¼ˆå¬å›+ç‰¹å¾ï¼‰ã€‚è®©æˆ‘å…ˆæ¢ç´¢ä¸€ä¸‹é¡¹ç›®ç»“æ„æ¥äº†è§£å½“å‰çš„å®ç°æƒ…å†µã€‚


Ran tool
è®©æˆ‘æŸ¥çœ‹ä¸€ä¸‹ä¸»è¦çš„åº”ç”¨ç›®å½•å’Œé…ç½®æ–‡ä»¶ï¼Œäº†è§£é¡¹ç›®çš„å…·ä½“æ¶æ„ï¼š


Ran tool

Ran tool

Ran tool

Read file: README.md
ç°åœ¨è®©æˆ‘æŸ¥çœ‹ä¸€ä¸‹é¡¹ç›®çš„å…·ä½“å®ç°ï¼Œç‰¹åˆ«æ˜¯Celeryé…ç½®å’ŒOpenSearchç›¸å…³çš„ä»£ç ï¼š


Ran tool

Ran tool

Read file: infra/local/docker-compose.yaml
ç°åœ¨è®©æˆ‘æŸ¥çœ‹ä¸€ä¸‹Wagtailåº”ç”¨çš„é…ç½®å’ŒCeleryç›¸å…³çš„ä»£ç ï¼š


Ran tool

Read file: authoring/authoring/celery.py

Ran tool

Read file: authoring/authoring/settings/base.py
ç°åœ¨è®©æˆ‘æŸ¥çœ‹ä¸€ä¸‹æœç´¢åº”ç”¨å’Œç›¸å…³çš„ä»»åŠ¡å®ç°ï¼š


Ran tool

Read file: apps/searchapp/tasks.py

Read file: apps/searchapp/indexer.py

Read file: apps/searchapp/client.py
ç°åœ¨è®©æˆ‘æŸ¥çœ‹ä¸€ä¸‹Wagtailçš„ä¿¡å·å¤„ç†ï¼Œçœ‹çœ‹æ˜¯å¦‚ä½•è§¦å‘ç´¢å¼•ä»»åŠ¡çš„ï¼š


Search files...

Search files...
è®©æˆ‘æŸ¥çœ‹ä¸€ä¸‹æ–°é—»åº”ç”¨çš„æ¨¡å‹å’Œä¿¡å·å¤„ç†ï¼š


Ran tool

Read file: apps/news/signals.py
ç°åœ¨è®©æˆ‘æŸ¥çœ‹ä¸€ä¸‹ç®¡ç†å‘½ä»¤ï¼Œäº†è§£OpenSearchç´¢å¼•çš„åˆå§‹åŒ–å’Œç®¡ç†ï¼š


Ran tool

Ran tool

Read file: apps/searchapp/management/commands/os_alias_bootstrap.py

Read file: apps/searchapp/management/commands/os_reindex_switch.py
ç°åœ¨è®©æˆ‘æŸ¥çœ‹ä¸€ä¸‹APIåº”ç”¨ï¼Œäº†è§£æœç´¢æ¥å£çš„å®ç°ï¼š


Ran tool

Ran tool

Read file: apps/api/rest/feed.py
ç°åœ¨è®©æˆ‘æŸ¥çœ‹ä¸€ä¸‹æŸ¥è¯¢æ„å»ºå’Œç‰¹å¾æå–çš„å®ç°ï¼š


Read file: apps/searchapp/queries.py
ç°åœ¨è®©æˆ‘æŸ¥çœ‹ä¸€ä¸‹ç‰¹å¾æå–å’Œæ’åºçš„å®ç°ï¼š


Read file: apps/api/rest/features.py

Read file: apps/api/rest/rank.py
ç°åœ¨è®©æˆ‘æŸ¥çœ‹ä¸€ä¸‹ç‰¹å¾æ›´æ–°çš„å®šæ—¶ä»»åŠ¡ï¼š


Read file: 

Read file: apps/searchapp/metrics.py
åŸºäºæˆ‘å¯¹é¡¹ç›®ä»£ç çš„åˆ†æï¼Œæˆ‘å¯ä»¥å›ç­”ä½ çš„é—®é¢˜ï¼š

## é¡¹ç›®æ¶æ„å®ç°æƒ…å†µåˆ†æ

ä½ çš„é¡¹ç›®**åŸºæœ¬æ»¡è¶³**äº† `Wagtailï¼ˆAuthoringï¼‰ â†’ Celery Indexer â†’ OpenSearchï¼ˆå¬å›+ç‰¹å¾ï¼‰` çš„æ¶æ„è¦æ±‚ï¼Œä½†è¿˜æœ‰ä¸€äº›å¯ä»¥ä¼˜åŒ–çš„åœ°æ–¹ï¼š

### âœ… å·²å®ç°çš„éƒ¨åˆ†

1. **Wagtailï¼ˆAuthoringï¼‰**
   - å®Œæ•´çš„Wagtail CMSé…ç½®
   - æ–°é—»æ–‡ç« æ¨¡å‹ï¼ˆArticlePageï¼‰
   - å¤šç«™ç‚¹æ”¯æŒ

2. **Celery Indexer**
   - Celeryé…ç½®å®Œæ•´ï¼ˆRedisä½œä¸ºbrokerï¼‰
   - ç´¢å¼•ä»»åŠ¡ï¼š`upsert_article_doc`ã€`delete_article_doc`
   - å®šæ—¶ä»»åŠ¡ï¼šæ¯åˆ†é’Ÿæ›´æ–°CTRç‰¹å¾
   - ä¿¡å·å¤„ç†ï¼šæ–‡ç« å‘å¸ƒ/å–æ¶ˆå‘å¸ƒæ—¶è‡ªåŠ¨è§¦å‘ç´¢å¼•

3. **OpenSearchï¼ˆå¬å›+ç‰¹å¾ï¼‰**
   - OpenSearchæœåŠ¡é…ç½®
   - ç‰ˆæœ¬åŒ–ç´¢å¼•ç®¡ç†ï¼ˆåˆ«ååˆ‡æ¢ï¼‰
   - ç‰¹å¾å­˜å‚¨ï¼šCTRã€çƒ­åº¦ã€è´¨é‡åˆ†ç­‰
   - æœç´¢æŸ¥è¯¢æ¨¡æ¿ç³»ç»Ÿ

### ï¿½ï¿½ å¯ä»¥ä¼˜åŒ–çš„éƒ¨åˆ†

1. **ç´¢å¼•å®æ—¶æ€§**
   - å½“å‰åªåœ¨æ–‡ç« å‘å¸ƒ/å–æ¶ˆæ—¶è§¦å‘ç´¢å¼•
   - å¯ä»¥è€ƒè™‘åœ¨æ–‡ç« ç¼–è¾‘æ—¶ä¹Ÿè§¦å‘ç´¢å¼•æ›´æ–°

2. **ç‰¹å¾å·¥ç¨‹**
   - å½“å‰ç‰¹å¾ç›¸å¯¹ç®€å•ï¼ˆCTRã€çƒ­åº¦ã€è´¨é‡åˆ†ï¼‰
   - å¯ä»¥å¢åŠ æ›´å¤šç‰¹å¾ï¼šç”¨æˆ·è¡Œä¸ºã€å†…å®¹ç›¸ä¼¼åº¦ã€æ—¶æ•ˆæ€§ç­‰

3. **ç´¢å¼•ç­–ç•¥**
   - å½“å‰ä½¿ç”¨ç‰ˆæœ¬åŒ–ç´¢å¼•ï¼Œé€‚åˆç”Ÿäº§ç¯å¢ƒ
   - å¯ä»¥è€ƒè™‘å¢é‡æ›´æ–°ç­–ç•¥

### ğŸ“Š å½“å‰æ¶æ„æµç¨‹

```
Wagtail CMS â†’ æ–‡ç« å‘å¸ƒ/ç¼–è¾‘ â†’ Djangoä¿¡å· â†’ Celeryä»»åŠ¡ â†’ OpenSearchç´¢å¼•
                                                      â†“
ClickHouseåŸ‹ç‚¹æ•°æ® â†’ å®šæ—¶ä»»åŠ¡ â†’ ç‰¹å¾æ›´æ–° â†’ OpenSearchæ–‡æ¡£æ›´æ–°
                                                      â†“
APIè¯·æ±‚ â†’ æŸ¥è¯¢æ„å»º â†’ OpenSearchå¬å› â†’ ç‰¹å¾èåˆ â†’ æ’åºå¤šæ ·æ€§ â†’ è¿”å›ç»“æœ
```

### ğŸš€ å»ºè®®æ”¹è¿›

1. **å¢åŠ æ›´å¤šç´¢å¼•è§¦å‘ç‚¹**ï¼š
   ```python
   # åœ¨æ–‡ç« ç¼–è¾‘æ—¶ä¹Ÿè§¦å‘ç´¢å¼•æ›´æ–°
   @receiver(page_saved)
   def on_save(sender, **kwargs):
       page = kwargs.get("instance")
       if isinstance(page, ArticlePage) and page.live:
           upsert_article_doc.delay(page.id)
   ```

2. **ä¼˜åŒ–ç‰¹å¾æ›´æ–°é¢‘ç‡**ï¼š
   - å½“å‰æ¯åˆ†é’Ÿæ›´æ–°ï¼Œå¯ä»¥æ ¹æ®ä¸šåŠ¡éœ€æ±‚è°ƒæ•´
   - è€ƒè™‘å®æ—¶ç‰¹å¾æ›´æ–°ï¼ˆå¦‚ç”¨æˆ·ç‚¹å‡»åç«‹å³æ›´æ–°ï¼‰

3. **å¢åŠ æ›´å¤šç‰¹å¾ç»´åº¦**ï¼š
   - ç”¨æˆ·ç”»åƒç‰¹å¾
   - å†…å®¹è¯­ä¹‰ç‰¹å¾
   - ç¤¾äº¤ä¼ æ’­ç‰¹å¾

æ€»çš„æ¥è¯´ï¼Œä½ çš„é¡¹ç›®å·²ç»å®ç°äº†å®Œæ•´çš„æ¨èç³»ç»Ÿæ¶æ„ï¼Œå…·å¤‡äº†ç”Ÿäº§ç¯å¢ƒçš„åŸºç¡€èƒ½åŠ›ã€‚è¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„èµ·ç‚¹ï¼Œå¯ä»¥æ ¹æ®å…·ä½“ä¸šåŠ¡éœ€æ±‚è¿›ä¸€æ­¥ä¼˜åŒ–å’Œæ‰©å±•ã€‚
