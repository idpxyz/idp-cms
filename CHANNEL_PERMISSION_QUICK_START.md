# 📋 频道权限管理 - 快速开始

## ✅ 已完成的工作

1. ✅ 创建 `ChannelGroupPermission` 模型（频道权限管理）
2. ✅ 应用数据库迁移（0036_add_channel_permissions）
3. ✅ 在 Wagtail 后台注册管理界面
4. ✅ 添加权限过滤钩子（自动过滤频道列表）
5. ✅ 重启后端服务

---

## 🎯 功能特性

### 🔐 权限类型

- **可查看**：用户能在后台看到这些频道
- **可编辑**：用户能修改频道设置
- **可发布文章**：用户能在该频道下发布文章

### 👥 用户角色

- **超级管理员**：不受限制，可访问所有频道
- **配置权限的用户组**：只能访问指定的频道
- **未配置权限的用户组**：默认可访问所有频道

---

## 🚀 5分钟快速配置

### 步骤 1：登录后台

访问：http://8.133.22.7:8000/admin/

### 步骤 2：创建用户组（如果还没有）

1. 点击 **设置** → **用户组**
2. 点击 **添加用户组**
3. 输入名称（例如：`新闻编辑`）
4. 保存

### 步骤 3：配置频道权限

1. 在左侧菜单找到 **Snippets** → **频道权限管理**（或搜索"频道权限"）
2. 点击 **添加频道权限**
3. 填写配置：
   ```
   用户组：选择"新闻编辑"
   可访问的频道：勾选允许访问的频道（如"新闻"、"体育"）
   ✅ 可查看
   ✅ 可发布文章
   ❌ 可编辑（不勾选）
   ```
4. 点击 **保存**

### 步骤 4：将用户添加到用户组

1. 点击 **设置** → **用户**
2. 编辑用户
3. 在 **用户组** 部分勾选 `新闻编辑`
4. 保存

### 步骤 5：测试权限

1. 使用该用户登录后台
2. 检查是否只能看到授权的频道

---

## 💡 配置示例

### 示例 1：限制实习编辑只能访问"娱乐"频道

```
用户组：实习编辑
可访问的频道：✅ 娱乐
✅ 可查看
✅ 可发布文章
❌ 可编辑
```

**效果**：该用户组只能看到"娱乐"频道，可以发布文章，但不能修改频道设置。

### 示例 2：频道管理员可以访问所有频道

```
用户组：频道管理员
可访问的频道：（不勾选任何频道 = 所有频道）
✅ 可查看
✅ 可编辑
✅ 可发布文章
```

**效果**：该用户组可以访问所有频道，并拥有完整权限。

### 示例 3：审核员只能查看，不能编辑

```
用户组：内容审核员
可访问的频道：（不勾选 = 所有频道）
✅ 可查看
❌ 可编辑
❌ 可发布文章
```

**效果**：可以查看所有频道，但不能修改或发布。

---

## 🔍 重要说明

### 默认行为

- **未配置权限**：用户可以访问所有频道（保持向后兼容）
- **留空频道列表**：表示可以访问所有频道
- **勾选特定频道**：只能访问这些频道

### 权限叠加

如果用户属于多个用户组，权限会叠加（取并集）：
```
用户属于：
  - 新闻编辑（可访问"新闻"）
  - 体育编辑（可访问"体育"）

结果：该用户可以访问"新闻"和"体育"两个频道
```

### 超级管理员

- 超级管理员**不受任何限制**
- 始终可以看到和管理所有频道
- 只有超级管理员能看到"频道权限管理"菜单

---

## ⚠️ 常见问题

### Q: 用户看不到任何频道？

**A:** 检查是否配置了权限但没有勾选任何频道，临时解决方案：
1. 进入频道权限管理
2. 编辑该用户组的权限
3. 确保勾选了至少一个频道，或者留空（表示所有频道）

### Q: 配置后没有生效？

**A:** 用户需要**重新登录**后权限才会生效。

### Q: 如何关闭权限系统？

**A:** 删除所有频道权限配置即可，系统会恢复默认行为（所有人可访问所有频道）。

---

## 📞 获取帮助

- 详细文档：`CHANNEL_PERMISSION_GUIDE.md`
- 如有问题，请联系系统管理员
- 数据库表：`core_channel_group_permission`

---

## 🎉 开始使用

现在就可以登录后台，创建第一个频道权限配置了！

访问：**http://8.133.22.7:8000/admin/**

