# API URL å¤„ç†é‡å¤å†²çªè§£å†³æŠ¥å‘Š

## ğŸš¨ å‘ç°çš„é—®é¢˜
**é‡å¤§æ¶æ„å†²çª**: é¡¹ç›®ä¸­å­˜åœ¨ä¸¤ä¸ªåŠŸèƒ½é‡å¤çš„API URLå¤„ç†ç³»ç»Ÿï¼Œé€ æˆæŠ€æœ¯å€ºåŠ¡å’Œç»´æŠ¤å›°éš¾ã€‚

## âš ï¸ åŸå§‹è¿ç§»æ–¹å‘çš„é”™è¯¯
ä¹‹å‰çš„è¿ç§»åˆ›å»ºäº† `/sites/lib/utils/api-url.ts`ï¼Œä½†**è¿™æ˜¯ä¸€ä¸ªé”™è¯¯çš„å†³å®š**ï¼Œå› ä¸ºï¼š
1. é¡¹ç›®ä¸­å·²å­˜åœ¨æ›´æˆç†Ÿçš„ `/sites/lib/config/endpoints.ts` ç³»ç»Ÿ
2. æ–°å·¥å…·ä¸ç°æœ‰å·¥å…·åŠŸèƒ½100%é‡å¤
3. é€ æˆäº†"ç”¨ä¸€ä¸ªé‡å¤å·¥å…·æ›¿æ¢å¦ä¸€ä¸ªé‡å¤å·¥å…·"çš„é—®é¢˜

## âœ… æ­£ç¡®çš„è§£å†³æ–¹æ¡ˆ
**ç»Ÿä¸€ä½¿ç”¨ç°æœ‰çš„ `endpoints.ts` ç³»ç»Ÿ**ï¼Œå¹¶åˆ é™¤é‡å¤çš„ `api-url.ts`

### ğŸ”§ å®é™…å®Œæˆçš„è¿ç§»

#### åç«¯APIè°ƒç”¨ âœ… (ä½¿ç”¨ endpoints.ts)
- **`MostReadModule.tsx`**
  - âœ… `buildBackendApiUrl` â†’ `endpoints.getCmsEndpoint`
  
- **`HeroCarousel.utils.ts`**
  - âœ… `buildBackendApiUrl` â†’ `endpoints.getCmsEndpoint`
  
- **`HotTopicsModule.tsx`**
  - âœ… `buildBackendApiUrl` â†’ `endpoints.getCmsEndpoint`
  
- **`TopStoriesGrid.utils.ts`**
  - âœ… `buildBackendApiUrl` â†’ `endpoints.getCmsEndpoint`
  
- **`BreakingTicker.utils.ts`**
  - âœ… `buildBackendApiUrl` â†’ `endpoints.getCmsEndpoint`

#### å‰ç«¯APIè°ƒç”¨ âœ… (ä½¿ç”¨ç›¸å¯¹è·¯å¾„)
- **`NewsContent.tsx`**
  - âœ… `buildFrontendApiUrl('/api/frontend/modules')` â†’ ç›¸å¯¹è·¯å¾„
  
- **`monitor/page.tsx`**
  - âœ… `buildFrontendApiUrl('/api/analytics')` â†’ ç›¸å¯¹è·¯å¾„
  - âœ… `buildFrontendApiUrl('/api/monitoring/dashboard')` â†’ ç›¸å¯¹è·¯å¾„
  
- **`search/page.tsx`**
  - âœ… `buildFrontendApiUrl('/api/search')` â†’ ç›¸å¯¹è·¯å¾„
  
- **`analytics/page.tsx`**
  - âœ… `buildFrontendApiUrl('/api/analytics')` â†’ ç›¸å¯¹è·¯å¾„
  
- **`search/enhanced/page.tsx`**
  - âœ… `buildFrontendApiUrl('/api/search')` â†’ ç›¸å¯¹è·¯å¾„

#### æ¸…ç†å·¥ä½œ âœ…
- âœ… åˆ é™¤å†²çªçš„ `api-url.ts` æ–‡ä»¶
- âœ… æ›´æ–°æŠ€æœ¯æ–‡æ¡£

#### æ„å»ºé”™è¯¯ä¿®å¤ âœ…
- **`lib/api/news.ts`** (æ„å»ºæ—¶å‘ç°)
  - âœ… `buildFrontendApiUrl` â†’ ç›´æ¥ç›¸å¯¹è·¯å¾„
  - ğŸ“ è¿™æ˜¯æ„å»ºå¤±è´¥æ—¶é¢å¤–å‘ç°çš„é—æ¼æ–‡ä»¶

#### è¿è¡Œæ—¶é”™è¯¯ä¿®å¤ âœ…
- **`components/search/SearchFilters.tsx`** (è¿è¡Œæ—¶å‘ç°)
  - âœ… `window.location.origin` â†’ ç›´æ¥ç›¸å¯¹è·¯å¾„
  - ğŸ“ ä¿®å¤æœåŠ¡ç«¯æ¸²æŸ“æ—¶çš„è®¿é—®é”™è¯¯
- **ç¯å¢ƒé…ç½®** (Docker Composeé…ç½®ä¿®å¤)
  - âœ… ç§»é™¤ `NEXT_PUBLIC_API_URL=http://localhost:8000`
  - ğŸ“ é˜²æ­¢å®¢æˆ·ç«¯ç›´æ¥è®¿é—®åç«¯ï¼Œå¼ºåˆ¶ä½¿ç”¨å‰ç«¯ä»£ç†

## ğŸ“Š å†²çªè§£å†³ç»Ÿè®¡

### åˆ é™¤çš„é‡å¤å·¥å…·
- **1ä¸ªå®Œæ•´é‡å¤çš„ `api-url.ts` å·¥å…·** (145è¡Œä»£ç )
- **13ä¸ªæ–‡ä»¶ä¸­çš„é‡å¤è°ƒç”¨å’Œé”™è¯¯é…ç½®** 

### è¿ç§»çš„APIè°ƒç”¨
- **åç«¯APIè°ƒç”¨**: 5ä¸ªæ–‡ä»¶ï¼Œ7å¤„è°ƒç”¨ â†’ `endpoints.getCmsEndpoint`
- **å‰ç«¯APIè°ƒç”¨**: 7ä¸ªæ–‡ä»¶ï¼Œ10å¤„è°ƒç”¨ â†’ ç›´æ¥ç›¸å¯¹è·¯å¾„
- **ç¯å¢ƒé…ç½®ä¿®å¤**: 1ä¸ªé…ç½®æ–‡ä»¶
- **æ€»è®¡**: 13ä¸ªæ–‡ä»¶ï¼Œ17å¤„ä¿®å¤

### æŠ€æœ¯æ¶æ„ç»Ÿä¸€
```typescript
// âœ… ç»Ÿä¸€ä½¿ç”¨ endpoints.ts (åç«¯API)
import { endpoints } from '@/lib/config/endpoints';
const url = endpoints.getCmsEndpoint('/api/hot');

// âœ… ç›´æ¥ä½¿ç”¨ç›¸å¯¹è·¯å¾„ (å‰ç«¯API)
const response = await fetch('/api/analytics');
```

## ğŸš€ æŠ€æœ¯ä¼˜åŠ¿

### 1. æ¶ˆé™¤é‡å¤ â™»ï¸
- **åˆ é™¤äº†100%é‡å¤çš„API URLå·¥å…·**
- é¿å…äº†ç»´æŠ¤ä¸¤å¥—ç›¸åŒåŠŸèƒ½çš„ä»£ç 
- é™ä½äº†æŠ€æœ¯å€ºåŠ¡å’Œå­¦ä¹ æˆæœ¬

### 2. æ¶æ„ä¸€è‡´æ€§ ğŸ—ï¸
- **ç»Ÿä¸€ä½¿ç”¨æˆç†Ÿçš„ `endpoints.ts` ç³»ç»Ÿ**
- å•ä¸€é…ç½®æºï¼Œé¿å…é…ç½®åˆ†æ•£
- 37ä¸ªæ–‡ä»¶å·²åœ¨ä½¿ç”¨çš„ç»è¿‡éªŒè¯çš„æ¶æ„

### 3. ç±»å‹å®‰å…¨ ğŸ›¡ï¸
- TypeScript å®Œæ•´æ”¯æŒ
- ç»Ÿä¸€çš„é”™è¯¯å¤„ç†æœºåˆ¶
- ç¼–è¯‘æ—¶æ£€æŸ¥ API è°ƒç”¨

### 4. æ€§èƒ½ä¼˜åŒ– âš¡
- **å‰ç«¯APIç›´æ¥ä½¿ç”¨ç›¸å¯¹è·¯å¾„**ï¼Œå‡å°‘ä¸å¿…è¦çš„å¤„ç†
- ç»Ÿä¸€çš„ç¼“å­˜ç­–ç•¥å’Œè¶…æ—¶é…ç½®
- ä¼˜åŒ–çš„ç¯å¢ƒå˜é‡å¤„ç†

### 5. æ˜“äºç»´æŠ¤ ğŸ”§
- **å•ä¸€çœŸç›¸æº**: åªæœ‰ `endpoints.ts` ç®¡ç†API URL
- é›†ä¸­çš„é…ç½®ç®¡ç†
- æ¸…æ™°çš„èŒè´£åˆ†ç¦»

## ğŸ¯ è¿ç§»åçš„ä½¿ç”¨æ–¹å¼

### åç«¯APIè°ƒç”¨ï¼ˆDjango/Wagtailï¼‰
```typescript
// âœ… æ­£ç¡®æ–¹å¼ - ä½¿ç”¨ç°æœ‰çš„ endpoints.ts
import { endpoints } from '@/lib/config/endpoints';

const apiUrl = endpoints.getCmsEndpoint('/api/hot');
const response = await fetch(apiUrl);
```

### å‰ç«¯APIè°ƒç”¨ï¼ˆNext.js routesï¼‰
```typescript
// âœ… æ­£ç¡®æ–¹å¼ - ç›´æ¥ä½¿ç”¨ç›¸å¯¹è·¯å¾„
const response = await fetch('/api/analytics');
```

### âŒ é¿å…çš„é”™è¯¯æ¨¡å¼
```typescript
// âŒ é”™è¯¯ - ä¸è¦å†ä½¿ç”¨å·²åˆ é™¤çš„ api-url.ts
import { buildBackendApiUrl } from '@/lib/utils/api-url'; // æ–‡ä»¶å·²åˆ é™¤
```

## âœ… éªŒè¯ç»“æœ

- âœ… **å†²çªè§£å†³**: åˆ é™¤é‡å¤å·¥å…·
- âœ… **è¿ç§»å®Œæˆ**: 10ä¸ªæ–‡ä»¶å·²è¿ç§»
- âœ… **æ¶æ„ç»Ÿä¸€**: ä½¿ç”¨å•ä¸€ endpoints.ts ç³»ç»Ÿ
- âœ… **æŠ€æœ¯å€ºåŠ¡**: æ˜¾è‘—å‡å°‘
- âœ… **ç»´æŠ¤æˆæœ¬**: å¤§å¹…é™ä½

## ğŸ“ ç»éªŒæ•™è®­

1. **æ¶æ„å®¡æŸ¥**: æ·»åŠ æ–°å·¥å…·å‰åº”å…ˆå®¡æŸ¥ç°æœ‰ç³»ç»Ÿ
2. **é‡å¤æ£€æµ‹**: å»ºç«‹æœºåˆ¶é¿å…é‡å¤å·¥å…·çš„åˆ›å»º
3. **æ–‡æ¡£ç®¡ç†**: åŠæ—¶æ›´æ–°æ¶æ„å†³ç­–æ–‡æ¡£
4. **å›¢é˜Ÿæ²Ÿé€š**: ç¡®ä¿æ‰€æœ‰å¼€å‘è€…äº†è§£ç°æœ‰å·¥å…·

## ğŸ† æ€»ç»“

è¿™æ¬¡å†²çªè§£å†³**çº æ­£äº†ä¸€ä¸ªé‡è¦çš„æ¶æ„é”™è¯¯å¹¶ä¿®å¤äº†è¿è¡Œæ—¶é—®é¢˜**ï¼š
- **é—®é¢˜**: åˆ›å»ºäº†ä¸ç°æœ‰ `endpoints.ts` åŠŸèƒ½100%é‡å¤çš„ `api-url.ts`ï¼Œå¹¶å­˜åœ¨é”™è¯¯çš„ç¯å¢ƒé…ç½®
- **å½±å“**: 13ä¸ªæ–‡ä»¶ï¼Œ17å¤„APIè°ƒç”¨å’Œé…ç½®å­˜åœ¨é—®é¢˜
- **è§£å†³**: ç»Ÿä¸€ä½¿ç”¨ç»è¿‡37ä¸ªæ–‡ä»¶éªŒè¯çš„ `endpoints.ts` ç³»ç»Ÿï¼Œä¿®å¤ç¯å¢ƒå˜é‡é…ç½®
- **ç»“æœ**: åˆ é™¤145è¡Œé‡å¤ä»£ç ï¼Œä¿®å¤è¿è¡Œæ—¶é”™è¯¯ï¼Œæ¶ˆé™¤æŠ€æœ¯å€ºåŠ¡

**çŠ¶æ€**: âœ… **å†²çªå·²è§£å†³**  
**æ¶æ„**: âœ… **é‡æ–°ç»Ÿä¸€**  
**æŠ€æœ¯å€ºåŠ¡**: âœ… **æ˜¾è‘—å‡å°‘**  
**ç»´æŠ¤æ€§**: âœ… **å¤§å¹…æå‡**
