# ğŸ“„ ç¯å¢ƒå˜é‡æ–‡ä»¶è¯´æ˜æŒ‡å—

## ğŸ“‹ æ–‡ä»¶æ¸…å•ä¸ç”¨é€”

### âœ… **æ ¸å¿ƒæ–‡ä»¶ï¼ˆå¿…éœ€ï¼‰**

#### 1. `.env.core` âœ… **å¿…éœ€**
**ç”¨é€”**: æ ¸å¿ƒåŸºç¡€é…ç½®ï¼Œæ‰€æœ‰ç¯å¢ƒå…±äº«  
**è¢«å¼•ç”¨**: å¼€å‘ã€ç”Ÿäº§ç¯å¢ƒéƒ½ä½¿ç”¨  
**å†…å®¹**: 
- æ•°æ®åº“åŸºç¡€é…ç½® (POSTGRES_USER, POSTGRES_DB)
- Redis åŸºç¡€é…ç½®
- Django SECRET_KEY
- åŸºç¡€ URL é…ç½®

**å¼•ç”¨ä½ç½®**:
```yaml
# infra/local/docker-compose.yml
# infra/production/docker-compose-ha-node1.yml
env_file:
  - ../../.env.core
```

**çŠ¶æ€**: âœ… ä¿ç•™

---

#### 2. `.env.features` âœ… **å¿…éœ€**
**ç”¨é€”**: åŠŸèƒ½ç‰¹æ€§å¼€å…³å’Œç¬¬ä¸‰æ–¹æœåŠ¡é…ç½®  
**è¢«å¼•ç”¨**: å¼€å‘ã€ç”Ÿäº§ç¯å¢ƒéƒ½ä½¿ç”¨  
**å†…å®¹**:
- åŠŸèƒ½å¼€å…³ (ENABLE_XXX)
- ç¬¬ä¸‰æ–¹æœåŠ¡ API Key
- å¯é€‰åŠŸèƒ½é…ç½®

**å¼•ç”¨ä½ç½®**:
```yaml
# infra/local/docker-compose.yml
# infra/production/docker-compose-ha-node1.yml
env_file:
  - ../../.env.core
  - ../../.env.features
```

**çŠ¶æ€**: âœ… ä¿ç•™

---

#### 3. `.env.development` âœ… **å¼€å‘ç¯å¢ƒä½¿ç”¨**
**ç”¨é€”**: å¼€å‘ç¯å¢ƒç‰¹å®šé…ç½®  
**è¢«å¼•ç”¨**: ä»…å¼€å‘ç¯å¢ƒ  
**å†…å®¹**:
- å¼€å‘ç¯å¢ƒ Django è®¾ç½®
- å¼€å‘ç¯å¢ƒ URL
- è°ƒè¯•é…ç½®

**å¼•ç”¨ä½ç½®**:
```yaml
# infra/local/docker-compose.yml
env_file:
  - ../../.env.core
  - ../../.env.features
  - ../../.env.development
```

**çŠ¶æ€**: âœ… ä¿ç•™

---

#### 4. `.env.node1` âœ… **ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ï¼ˆå½“å‰ï¼‰**
**ç”¨é€”**: ç”Ÿäº§ç¯å¢ƒèŠ‚ç‚¹1çš„ç‰¹å®šé…ç½®  
**è¢«å¼•ç”¨**: ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²  
**å†…å®¹**:
- ç”Ÿäº§ç¯å¢ƒæ‰€æœ‰å¯†ç 
- èŠ‚ç‚¹1çš„ IP å’Œç½‘ç»œé…ç½®
- ç”Ÿäº§ç¯å¢ƒ URL

**å¼•ç”¨ä½ç½®**:
```yaml
# infra/production/docker-compose-ha-node1.yml
env_file:
  - ../../.env.core
  - ../../.env.features
  - ../../.env.node1
```

**çŠ¶æ€**: âœ… **å½“å‰æ­£åœ¨ä½¿ç”¨ï¼Œå·²æ›´æ–°ä¸ºç»Ÿä¸€å¯†ç **

---

### âš ï¸ **æ¨¡æ¿/å¤‡ä»½æ–‡ä»¶**

#### 5. `.env.node1.production` âš ï¸ **æ—§æ¨¡æ¿**
**ç”¨é€”**: èŠ‚ç‚¹1çš„ç”Ÿäº§ç¯å¢ƒæ¨¡æ¿ï¼ˆæ—§ç‰ˆï¼‰  
**è¢«å¼•ç”¨**: æ—   
**å†…å®¹**: æ—§çš„å¯†ç é…ç½®

**çŠ¶æ€**: âš ï¸ **å¯ä»¥åˆ é™¤**ï¼ˆå·²è¢« `.env.node1` æ›¿ä»£ï¼‰

---

#### 6. `.env.node2.production` âš ï¸ **æœªæ¥ä½¿ç”¨**
**ç”¨é€”**: èŠ‚ç‚¹2çš„ç”Ÿäº§ç¯å¢ƒé…ç½®æ¨¡æ¿  
**è¢«å¼•ç”¨**: æš‚æ— ï¼ˆæœªæ¥æ‰©å±•åˆ° node2 æ—¶ä½¿ç”¨ï¼‰  
**å†…å®¹**: èŠ‚ç‚¹2çš„é…ç½®

**çŠ¶æ€**: âš ï¸ **ä¿ç•™**ï¼ˆæœªæ¥æ‰©å±•æ—¶éœ€è¦ï¼‰

---

#### 7. `.env.production` âš ï¸ **æ—§ç‰ˆæ–‡ä»¶**
**ç”¨é€”**: æ—§çš„ç”Ÿäº§ç¯å¢ƒé…ç½®ï¼ˆå•èŠ‚ç‚¹æ¨¡å¼ï¼‰  
**è¢«å¼•ç”¨**: æ— ï¼ˆå·²è¢« `.env.node1` æ›¿ä»£ï¼‰  
**å†…å®¹**: æ—§çš„ç”Ÿäº§é…ç½®

**çŠ¶æ€**: âš ï¸ **å¯ä»¥åˆ é™¤**ï¼ˆå·²ä¸ä½¿ç”¨ï¼‰

---

#### 8. `.env.production.ha.example` âš ï¸ **ç¤ºä¾‹æ–‡ä»¶**
**ç”¨é€”**: é«˜å¯ç”¨æ¨¡å¼çš„é…ç½®ç¤ºä¾‹  
**è¢«å¼•ç”¨**: æ— ï¼ˆä»…ä½œä¸ºå‚è€ƒï¼‰  
**å†…å®¹**: é…ç½®æ¨¡æ¿å’Œè¯´æ˜

**çŠ¶æ€**: âœ… **ä¿ç•™**ï¼ˆä½œä¸ºæ–‡æ¡£å‚è€ƒï¼‰

---

#### 9. `.env.node1.backup.20251016224548` âŒ **å¤‡ä»½æ–‡ä»¶**
**ç”¨é€”**: è‡ªåŠ¨å¤‡ä»½æ–‡ä»¶  
**è¢«å¼•ç”¨**: æ—   
**å†…å®¹**: .env.node1 çš„æ—§ç‰ˆæœ¬

**çŠ¶æ€**: âŒ **å¯ä»¥åˆ é™¤**ï¼ˆæˆ–ç§»åˆ° backups/ ç›®å½•ï¼‰

---

## ğŸ“Š ä½¿ç”¨å…³ç³»å›¾

```
å¼€å‘ç¯å¢ƒ (infra/local/)
â”œâ”€â”€ .env.core            âœ… æ ¸å¿ƒé…ç½®
â”œâ”€â”€ .env.features        âœ… åŠŸèƒ½å¼€å…³
â””â”€â”€ .env.development     âœ… å¼€å‘ç‰¹å®š

ç”Ÿäº§ç¯å¢ƒ (infra/production/)
â”œâ”€â”€ .env.core            âœ… æ ¸å¿ƒé…ç½®ï¼ˆå…±äº«ï¼‰
â”œâ”€â”€ .env.features        âœ… åŠŸèƒ½å¼€å…³ï¼ˆå…±äº«ï¼‰
â””â”€â”€ .env.node1           âœ… èŠ‚ç‚¹1é…ç½®ï¼ˆå½“å‰ä½¿ç”¨ï¼‰

æœªæ¥æ‰©å±• (node2)
â”œâ”€â”€ .env.core            âœ… æ ¸å¿ƒé…ç½®ï¼ˆå…±äº«ï¼‰
â”œâ”€â”€ .env.features        âœ… åŠŸèƒ½å¼€å…³ï¼ˆå…±äº«ï¼‰
â””â”€â”€ .env.node2.production âš ï¸ èŠ‚ç‚¹2é…ç½®ï¼ˆæœªæ¥ï¼‰
```

---

## ğŸ—‘ï¸ æ¸…ç†å»ºè®®

### å¯ä»¥å®‰å…¨åˆ é™¤çš„æ–‡ä»¶

```bash
# 1. æ—§çš„ç”Ÿäº§ç¯å¢ƒé…ç½®ï¼ˆå·²è¢« .env.node1 æ›¿ä»£ï¼‰
rm .env.production

# 2. æ—§çš„æ¨¡æ¿æ–‡ä»¶ï¼ˆå·²è¢« .env.node1 æ›¿ä»£ï¼‰
rm .env.node1.production

# 3. è‡ªåŠ¨å¤‡ä»½æ–‡ä»¶ï¼ˆç§»åˆ° backups/ï¼‰
mkdir -p backups/env/
mv .env.node1.backup.* backups/env/
```

### ä¿ç•™çš„æ–‡ä»¶

```bash
# æ ¸å¿ƒæ–‡ä»¶ï¼ˆå¿…éœ€ï¼‰
.env.core            # âœ… æ‰€æœ‰ç¯å¢ƒå…±äº«
.env.features        # âœ… æ‰€æœ‰ç¯å¢ƒå…±äº«
.env.development     # âœ… å¼€å‘ç¯å¢ƒ
.env.node1           # âœ… ç”Ÿäº§ç¯å¢ƒèŠ‚ç‚¹1ï¼ˆå½“å‰ï¼‰

# æœªæ¥ä½¿ç”¨
.env.node2.production           # âš ï¸ èŠ‚ç‚¹2ï¼ˆä¿ç•™ï¼‰
.env.production.ha.example      # âœ… æ–‡æ¡£å‚è€ƒï¼ˆä¿ç•™ï¼‰
```

---

## ğŸ”’ å½“å‰ç”Ÿäº§ç¯å¢ƒé…ç½®

**å®é™…ä½¿ç”¨çš„ç¯å¢ƒå˜é‡åŠ è½½é¡ºåº**:

```yaml
# docker-compose-ha-node1.yml
env_file:
  - ../../.env.core         # 1ï¸âƒ£ åŸºç¡€é…ç½®
  - ../../.env.features     # 2ï¸âƒ£ åŠŸèƒ½å¼€å…³
  - ../../.env.node1        # 3ï¸âƒ£ èŠ‚ç‚¹1ç‰¹å®šé…ç½®ï¼ˆè¦†ç›–å‰ä¸¤è€…ï¼‰
```

**ä¼˜å…ˆçº§**: `.env.node1` > `.env.features` > `.env.core`

---

## âœ… æœ€ç»ˆå»ºè®®

### ç«‹å³æ¸…ç†
```bash
# åˆ é™¤æ— ç”¨æ–‡ä»¶
rm .env.production
rm .env.node1.production

# å¤‡ä»½æ–‡ä»¶ç§»åˆ°ä¸“é—¨ç›®å½•
mkdir -p backups/env/
mv .env.node1.backup.* backups/env/ 2>/dev/null || true
```

### ä¿ç•™æ–‡ä»¶ï¼ˆ6ä¸ªï¼‰
1. `.env.core` âœ…
2. `.env.features` âœ…
3. `.env.development` âœ…
4. `.env.node1` âœ…
5. `.env.node2.production` âš ï¸ (æœªæ¥ä½¿ç”¨)
6. `.env.production.ha.example` ğŸ“– (æ–‡æ¡£)

---

**æ€»ç»“**: å½“å‰é¡¹ç›®æœ‰ 9 ä¸ª .env æ–‡ä»¶ï¼Œå®é™…ä½¿ç”¨çš„åªæœ‰ 4 ä¸ªï¼Œå¯ä»¥å®‰å…¨åˆ é™¤ 3 ä¸ªã€‚
